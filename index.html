<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Builder Pro - Optimizador de ROI</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #238636; --text: #c9d1d9; --gold: #d29922; --win: #2ea043; --loss: #f85149; --info: #58a6ff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; }
        textarea { width: 100%; height: 250px; background: #010409; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 6px; box-sizing: border-box; font-family: 'Courier New', monospace; }
        .panel { background: var(--card); border: 1px solid #30363d; border-radius: 6px; padding: 20px; margin-bottom: 20px; }
        button { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1em; }
        button:hover { background: #2ea043; filter: brightness(1.1); }
        .bot-config { background: #010409; border: 1px solid var(--gold); padding: 15px; border-radius: 6px; color: var(--gold); font-family: monospace; line-height: 1.5; }
        .match-entry { border-bottom: 1px solid #30363d; padding: 12px 0; display: flex; justify-content: space-between; align-items: center; }
        .status-win { background: var(--win); color: white; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; }
        .status-loss { background: var(--loss); color: white; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8em; }
        .metric { font-size: 0.85em; color: #8b949e; margin-right: 10px; }
        h2, h3 { color: white; margin-top: 0; }
        .highlight { color: var(--info); font-weight: bold; }
        .suggestion-box { background: rgba(88, 166, 255, 0.1); border: 1px solid var(--info); padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" style="text-align:center; margin-bottom: 20px;">
        <h2>‚öΩ Generador de Bots Rentables (HT Strategy)</h2>
        <p>Analizador de Patrones para Cuota 1.60 con Optimizaci√≥n de ROI</p>
    </div>

    <div class="grid">
        <div class="left-col">
            <div class="panel">
                <h3>1. Datos del Reporte</h3>
                <textarea id="dataInput" placeholder="Pega aqu√≠ las filas de tu reporte..."></textarea>
                <button onclick="processData()" style="margin-top: 15px;">Analizar y Optimizar Rentabilidad</button>
            </div>

            <div class="panel">
                <h3>2. Auditor√≠a de Partidos (Filtro HT)</h3>
                <div id="matchList">Los resultados aparecer√°n aqu√≠...</div>
            </div>
        </div>

        <div class="right-col">
            <div class="panel">
                <h3>ü§ñ Bot Configurado</h3>
                <div id="botRecommendation" class="bot-config">Esperando an√°lisis...</div>
                <div id="botStats" style="margin-top:15px;"></div>
            </div>

            <div class="panel" style="border-color: var(--info);">
                <h3>üìà An√°lisis de Rentabilidad</h3>
                <p style="font-size: 0.9em;">Basado en cuota fija de <span class="highlight">1.60</span>:</p>
                <div id="roiBox"></div>
                <div id="optimizationTip"></div>
            </div>
        </div>
    </div>
</div>

<script>
function processData() {
    const input = document.getElementById('dataInput').value;
    const lines = input.split('\n');
    const matchList = document.getElementById('matchList');
    
    // Variables de control para b√∫squeda de rentabilidad
    let totalAnalyzed = 0;
    let winners = 0;
    
    // Par√°metros de "Filtro Agresivo" para subir el ROI
    const MIN_AP_MINUTO = 1.35; // Subimos de 1.0 a 1.35 para filtrar ruido
    const MIN_TIROS_ON = 1;     // Exigimos al menos 1 tiro a puerta

    matchList.innerHTML = "";

    lines.forEach((line) => {
        if (line.toLowerCase().includes('match') || line.trim() === "") return;
        const cols = line.split('\t');
        if (cols.length < 42) return;

        const matchName = cols[6];
        const minute = parseInt(cols[7]);
        const apH = parseInt(cols[11]) || 0;
        const apA = parseInt(cols[12]) || 0;
        const shOnH = parseInt(cols[15]) || 0;
        const shOnA = parseInt(cols[16]) || 0;
        const resultHT = cols[41].trim();

        const isWin = (resultHT !== "0-0" && resultHT !== "");
        const totalAP = apH + apA;
        const apMin = totalAP / (minute || 1);
        const totalShotsOn = shOnH + shOnA;

        // APLICACI√ìN DEL FILTRO DE RENTABILIDAD
        // Solo analizamos partidos que realmente tienen presi√≥n de gol
        if (apMin >= MIN_AP_MINUTO && totalShotsOn >= MIN_TIROS_ON) {
            totalAnalyzed++;
            if (isWin) winners++;

            const div = document.createElement('div');
            div.className = 'match-entry';
            div.innerHTML = `
                <div>
                    <strong>${matchName}</strong><br>
                    <span class="metric">AP/m: ${apMin.toFixed(2)}</span>
                    <span class="metric">Shots On: ${totalShotsOn}</span>
                </div>
                <span class="${isWin ? 'status-win' : 'status-loss'}">
                    ${isWin ? 'GANADA (' + resultHT + ')' : 'PERDIDA (0-0)'}
                </span>
            `;
            matchList.appendChild(div);
        }
    });

    displayResults(totalAnalyzed, winners, MIN_AP_MINUTO, MIN_TIROS_ON);
}

function displayResults(total, wins, apMin, shots) {
    const botRec = document.getElementById('botRecommendation');
    const roiBox = document.getElementById('roiBox');
    const optTip = document.getElementById('optimizationTip');

    if (total > 0) {
        const winRate = ((wins / total) * 100).toFixed(1);
        const roi = ((wins * 1.60 - total) / total * 100).toFixed(1);
        const isPositive = roi > 0;

        botRec.innerHTML = `
<strong>ESTRATEGIA:</strong> HT_GOLD_SCANN<br>
<strong>MERCADO:</strong> Over 0.5 Goles HT<br>
<strong>CUOTA MIN:</strong> 1.60<br><br>
<strong>FILTROS RENTABLES:</strong><br>
1. AP/Min: > ${apMin}<br>
2. Tiros a Puerta: >= ${shots}<br>
3. Marcador: 0-0<br>
4. Tiempo: 18' - 30'
        `;

        roiBox.innerHTML = `
            <div style="font-size: 1.2em; margin-bottom:10px;">Strike Rate: <span class="highlight">${winRate}%</span></div>
            <div style="font-size: 1.4em; font-weight: bold; color: ${isPositive ? '#3fb950' : '#f85149'}">
                ROI: ${roi}% ${isPositive ? 'üöÄ' : '‚ö†Ô∏è'}
            </div>
        `;

        if (!isPositive) {
            optTip.innerHTML = `
                <div class="suggestion-box">
                    <strong>üí° Plan de Mejora:</strong><br>
                    Tu Strike Rate actual (${winRate}%) no cubre la cuota 1.60. 
                    Para ser rentable, el bot sugiere subir el filtro de <strong>AP/Min a 1.50</strong> 
                    o a√±adir un filtro de <strong>+2 C√≥rners</strong> en los primeros 20 min.
                </div>
            `;
        } else {
            optTip.innerHTML = `
                <div class="suggestion-box" style="border-color: #2ea043; background: rgba(46, 160, 67, 0.1);">
                    <strong>‚úÖ Patr√≥n Validado:</strong><br>
                    Esta configuraci√≥n es matem√°ticamente rentable a cuota 1.60. Mant√©n el stake plano.
                </div>
            `;
        }

    } else {
        document.getElementById('matchList').innerHTML = "No hay partidos que cumplan los filtros m√≠nimos de presi√≥n. Prueba con m√°s datos.";
    }
}
</script>
</body>
</html>
