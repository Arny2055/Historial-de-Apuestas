<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poisson Pro Mobile - Premier League</title>
    <style>
        :root {
            --primary: #00ff85; /* Color Premier League */
            --secondary: #3d195a;
            --bg: #f8f9fa;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: var(--bg); 
            margin: 0; 
            padding: 10px; 
            color: #333; 
        }
        .container { 
            max-width: 100%; 
            margin: auto; 
            background: white; 
            padding: 15px; 
            border-radius: 15px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            box-sizing: border-box;
        }
        h1 { text-align: center; color: var(--secondary); font-size: 1.4rem; margin-bottom: 20px; }
        
        .input-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--secondary); }
        textarea { 
            width: 100%; 
            height: 80px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            padding: 10px; 
            font-size: 12px; 
            box-sizing: border-box;
            background: #fafafa;
        }
        .avg-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin-bottom: 15px; 
        }
        input { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            box-sizing: border-box;
        }
        
        button { 
            width: 100%; 
            padding: 15px; 
            background-color: var(--primary); 
            color: var(--secondary); 
            border: none; 
            border-radius: 10px; 
            font-size: 1rem; 
            font-weight: bold; 
            cursor: pointer; 
            transition: 0.2s;
        }
        button:active { transform: scale(0.98); opacity: 0.8; }

        /* Tarjetas de Resultados */
        .match-card { 
            border: 1px solid #eee; 
            padding: 15px; 
            margin-top: 20px; 
            border-radius: 12px; 
            background: #fff; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .match-header { 
            background: var(--secondary);
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .btts-box {
            background: #eef2ff;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            border: 1px solid #d1d5db;
        }

        /* Responsive Tables */
        .tables-stack { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; 
        }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #f1f1f1; padding: 8px; border: 1px solid #eee; }
        td { padding: 8px; border: 1px solid #eee; text-align: center; }
        
        .highlight { font-weight: bold; color: #059669; }

        /* Estilo para iPhone 14 y similares (Pantallas grandes > 600px) */
        @media (min-width: 600px) {
            .tables-stack { flex-direction: row; }
            .container { max-width: 800px; padding: 25px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Premier Poisson Predictor</h1>
    
    <div class="input-group">
        <label>1. Pega Pr√≥ximos Partidos:</label>
        <textarea id="matchesInput" placeholder="Ej: Fri 26 Dec Manchester Utd 14:00 Newcastle Utd"></textarea>
    </div>
    
    <div class="input-group">
        <label>2. Stats Local:</label>
        <textarea id="homeStatsInput"></textarea>
    </div>
    
    <div class="input-group">
        <label>3. Stats Visitante:</label>
        <textarea id="awayStatsInput"></textarea>
    </div>

    <div class="avg-grid">
        <div>
            <label>Prom. Goles Local:</label>
            <input type="number" id="avgHomeGoals" step="0.01" value="1.61">
        </div>
        <div>
            <label>Prom. Goles Visita:</label>
            <input type="number" id="avgAwayGoals" step="0.01" value="1.22">
        </div>
    </div>

    <button onclick="calculatePoisson()">CALCULAR EN IPHONE</button>

    <div id="results"></div>
</div>

<script>
    function factorial(n) {
        let res = 1;
        for (let i = 2; i <= n; i++) res *= i;
        return res;
    }

    function poissonProb(lambda, x) {
        return (Math.exp(-lambda) * Math.pow(lambda, x)) / factorial(x);
    }

    function parseStats(text) {
        const stats = {};
        const lines = text.split('\n');
        lines.forEach(line => {
            const parts = line.trim().split(/\t|\s{2,}/);
            if (parts.length >= 7) {
                const teamName = parts[1].trim();
                stats[teamName] = { pj: parseFloat(parts[2]), gf: parseFloat(parts[6]), gc: parseFloat(parts[7]) };
            }
        });
        return stats;
    }

    function calculatePoisson() {
        const matchesText = document.getElementById('matchesInput').value.trim();
        const homeStats = parseStats(document.getElementById('homeStatsInput').value);
        const awayStats = parseStats(document.getElementById('awayStatsInput').value);
        const leagueAvgHome = parseFloat(document.getElementById('avgHomeGoals').value);
        const leagueAvgAway = parseFloat(document.getElementById('avgAwayGoals').value);

        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        matchesText.split('\n').forEach(line => {
            const parts = line.split(/\t|\s{2,}/);
            if (parts.length < 4) return;

            const homeTeam = parts[1].trim();
            const awayTeam = parts[3].trim();

            if (homeStats[homeTeam] && awayStats[awayTeam]) {
                const h = homeStats[homeTeam], a = awayStats[awayTeam];
                
                const lH = (h.gf/h.pj/leagueAvgHome) * (a.gc/a.pj/leagueAvgAway) * leagueAvgHome;
                const lA = (a.gf/a.pj/leagueAvgAway) * (h.gc/h.pj/leagueAvgHome) * leagueAvgAway;

                processMatch(homeTeam, awayTeam, lH, lA, resultsDiv);
            }
        });
    }

    function processMatch(home, away, lH, lA, container) {
        let overProbs = { 0.5: 0, 1.5: 0, 2.5: 0, 3.5: 0 };
        
        // Probabilidades de 0 goles (para BTTS)
        const probHomeZero = poissonProb(lH, 0);
        const probAwayZero = poissonProb(lA, 0);
        
        // Ambos anotan = (1 - Prob Local 0) * (1 - Prob Visita 0)
        const probBTTS = (1 - probHomeZero) * (1 - probAwayZero) * 100;

        for (let i = 0; i <= 6; i++) {
            for (let j = 0; j <= 6; j++) {
                const p = poissonProb(lH, i) * poissonProb(lA, j);
                const total = i + j;
                if (total > 0.5) overProbs[0.5] += p;
                if (total > 1.5) overProbs[1.5] += p;
                if (total > 2.5) overProbs[2.5] += p;
                if (total > 3.5) overProbs[3.5] += p;
            }
        }

        const card = document.createElement('div');
        card.className = 'match-card';
        card.innerHTML = `
            <div class="match-header">
                <strong>${home} vs ${away}</strong>
                <span>xG: ${(lH+lA).toFixed(2)}</span>
            </div>
            
            <div class="btts-box">
                Ambos Anotan (BTTS): <span style="color:#1a73e8">${probBTTS.toFixed(1)}%</span>
            </div>

            <div class="tables-stack">
                <table boder="0">
                    <thead><tr><th>Mercado</th><th>Over</th><th>Under</th></tr></thead>
                    <tbody>
                        <tr><td>0.5 Goles</td><td class="highlight">${(overProbs[0.5]*100).toFixed(1)}%</td><td>${((1-overProbs[0.5])*100).toFixed(1)}%</td></tr>
                        <tr><td>1.5 Goles</td><td class="highlight">${(overProbs[1.5]*100).toFixed(1)}%</td><td>${((1-overProbs[1.5])*100).toFixed(1)}%</td></tr>
                        <tr><td>2.5 Goles</td><td class="highlight">${(overProbs[2.5]*100).toFixed(1)}%</td><td>${((1-overProbs[2.5])*100).toFixed(1)}%</td></tr>
                        <tr><td>3.5 Goles</td><td class="highlight">${(overProbs[3.5]*100).toFixed(1)}%</td><td>${((1-overProbs[3.5])*100).toFixed(1)}%</td></tr>
                    </tbody>
                </table>

                <table>
                    <thead><tr><th>Goles</th><th>L (${home})</th><th>V (${away})</th></tr></thead>
                    <tbody>
                        ${[0,1,2,3].map(g => `
                            <tr><td>${g}</td><td>${(poissonProb(lH, g)*100).toFixed(1)}%</td><td>${(poissonProb(lA, g)*100).toFixed(1)}%</td></tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
        container.appendChild(card);
        window.scrollTo(0, document.body.scrollHeight);
    }
</script>

</body>
</html>
