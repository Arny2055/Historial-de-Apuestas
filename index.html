<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Rentabilidad por Equipo</title>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

<style>
body { font-family: Arial; background: #f4f4f9; padding: 20px; }
.container { max-width: 950px; margin: auto; background: #fff; padding: 25px; border-radius: 8px; }
h1 { text-align: center; color: #4caf50; }
input { width: 100%; padding: 10px; margin-top: 10px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 10px; }
th { background: #4caf50; color: white; }
.rentable { color: green; font-weight: bold; }
.no-rentable { color: red; font-weight: bold; }
.neutral { color: gray; font-weight: bold; }
</style>
</head>

<body>
<div class="container">
<h1>⚽ Rentabilidad por Equipo (desde Match)</h1>
<input type="file" id="fileInput" accept=".xlsx">
<div id="resultados"></div>
</div>

<script>
document.getElementById('fileInput').addEventListener('change', cargarArchivo);

function cargarArchivo(e) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, { defval: "" });

        procesarDatos(json);
    };
    reader.readAsArrayBuffer(e.target.files[0]);
}

function procesarDatos(data) {
    const resultados = {};

    data.forEach(row => {
        const match = String(row["Match"] || "").trim();
        const odd = parseFloat(row["Odd"]) || 1;
        const result = String(row["Result"]).toUpperCase();

        if (!match.includes("-")) return;

        const [home, away] = match.split("-").map(e => e.trim());

        const isWin = result === "WIN" || result === "WINNING" || result === "1";
        const profit = isWin ? (odd - 1) : -1;

        [home, away].forEach(team => {
            if (!resultados[team]) {
                resultados[team] = { partidos: 0, aciertos: 0, profit: 0 };
            }
            resultados[team].partidos++;
            if (isWin) resultados[team].aciertos++;
            resultados[team].profit += profit;
        });
    });

    mostrarTabla(resultados);
}

function mostrarTabla(resultados) {
    let html = `<table>
        <tr>
            <th>Equipo</th>
            <th>Partidos</th>
            <th>Aciertos</th>
            <th>Win %</th>
            <th>Profit</th>
            <th>Estado</th>
        </tr>`;

    const equipos = Object.entries(resultados)
        .map(([name, d]) => ({
            name,
            partidos: d.partidos,
            aciertos: d.aciertos,
            tasa: (d.aciertos / d.partidos) * 100,
            profit: d.profit
        }))
        .sort((a, b) => b.profit - a.profit);

    equipos.forEach(e => {
        const estado = e.profit > 0 ? "Rentable" : e.profit < 0 ? "Pérdida" : "Neutro";
        const clase = e.profit > 0 ? "rentable" : e.profit < 0 ? "no-rentable" : "neutral";

        html += `
        <tr>
            <td>${e.name}</td>
            <td>${e.partidos}</td>
            <td>${e.aciertos}</td>
            <td>${e.tasa.toFixed(1)}%</td>
            <td class="${clase}">${e.profit.toFixed(2)} u</td>
            <td class="${clase}">${estado}</td>
        </tr>`;
    });

    html += "</table>";
    document.getElementById("resultados").innerHTML = html;
}
</script>
</body>
</html>