<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poisson Data Processor - GitHub</title>
    <style>
        :root {
            --bg: #0e1621;
            --card: #17212b;
            --accent: #52a8ff;
            --success: #27ae60;
            --danger: #e74c3c;
            --text: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 1000px; margin: auto; background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #2b3948; box-sizing: border-box; }
        h1 { color: var(--accent); text-align: center; font-size: 1.5rem; }
        textarea { 
            width: 100%; height: 150px; background: var(--bg); color: #00ff00; 
            border: 1px solid #3d4b59; border-radius: 8px; padding: 10px; 
            font-family: monospace; font-size: 0.8rem; box-sizing: border-box; resize: vertical;
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 20px 0; }
        .card { background: #242f3d; padding: 15px; border-radius: 10px; }
        button { 
            width: 100%; padding: 15px; background: var(--accent); color: white; 
            border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;
        }
        .table-container { overflow-x: auto; margin-top: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th, td { padding: 12px; border-bottom: 1px solid #2b3948; text-align: center; }
        th { background: #1c2733; color: var(--accent); }
        .val-win { color: var(--success); font-weight: bold; }
        .stats-summary { font-size: 0.9rem; margin-bottom: 10px; color: #abaeb3; }
    </style>
</head>
<body>

<div class="container">
    <h1>Análisis Automático: Poisson de Últimos 10</h1>
    
    <div class="stats-summary">
        Pegue las filas de datos desde su base de datos (incluyendo nombres de equipos y Result FT). El sistema detectará automáticamente los goles de los últimos 10 encuentros.
    </div>

    <textarea id="raw_data" placeholder="Pegue aquí sus datos..."></textarea>

    <div class="grid">
        <div class="card">
            <label>Cuota Casa (Local):</label>
            <input type="number" id="c_local" value="2.00" step="0.01" style="width:100%; padding:8px; margin-top:5px; border-radius:5px; border:none;">
        </div>
        <div class="card">
            <label>Cuota Casa (Over 2.5):</label>
            <input type="number" id="c_over" value="1.95" step="0.01" style="width:100%; padding:8px; margin-top:5px; border-radius:5px; border:none;">
        </div>
    </div>

    <button onclick="procesarYCalcular()">Procesar Datos y Buscar Valor</button>

    <div id="res_area" style="display:none;">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Muestra Analizada</th>
                        <th>Media Goles (Total)</th>
                        <th>Probabilidad</th>
                        <th>Cuota Justa</th>
                        <th>EV (%)</th>
                    </tr>
                </thead>
                <tbody id="tabla-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function factorial(n) { return (n <= 1) ? 1 : n * factorial(n - 1); }
    function poisson(k, lambda) { return (Math.pow(Math.E, -lambda) * Math.pow(lambda, k)) / factorial(k); }

    function procesarYCalcular() {
        const rawText = document.getElementById('raw_data').value;
        const lineas = rawText.split('\n').filter(l => l.includes('-')); // Filtramos líneas con resultados (ej 2-1)
        
        // Tomamos los últimos 10
        const muestra = lineas.slice(-10);
        
        let totalGolesLocal = 0;
        let totalGolesVisita = 0;

        muestra.forEach(linea => {
            // Buscamos el patrón de goles (ej: "2-1")
            const match = linea.match(/(\d+)-(\d+)/);
            if (match) {
                totalGolesLocal += parseInt(match[1]);
                totalGolesVisita += parseInt(match[2]);
            }
        });

        const lambdaL = totalGolesLocal / muestra.length;
        const lambdaV = totalGolesVisita / muestra.length;
        const cuotaCasaL = parseFloat(document.getElementById('c_local').value);
        const cuotaCasaO = parseFloat(document.getElementById('c_over').value);

        let pWinL = 0, pOver25 = 0;

        // Distribución Poisson
        for (let i = 0; i <= 8; i++) {
            for (let j = 0; j <= 8; j++) {
                const prob = poisson(i, lambdaL) * poisson(j, lambdaV);
                if (i > j) pWinL += prob;
                if ((i + j) > 2.5) pOver25 += prob;
            }
        }

        const resultados = [
            { id: "Victoria Local", prob: pWinL, cuota: cuotaCasaL },
            { id: "Over 2.5 FT", prob: pOver25, cuota: cuotaCasaO }
        ];

        const tbody = document.getElementById('tabla-body');
        tbody.innerHTML = "";

        resultados.forEach(r => {
            const cJusta = 1 / r.prob;
            const ev = ((r.cuota / cJusta) - 1) * 100;
            tbody.innerHTML += `
                <tr>
                    <td>${r.id}</td>
                    <td>${(lambdaL + lambdaV).toFixed(2)}</td>
                    <td>${(r.prob * 100).toFixed(1)}%</td>
                    <td>${cJusta.toFixed(2)}</td>
                    <td class="${ev > 0 ? 'val-win' : ''}">${ev.toFixed(2)}%</td>
                </tr>
            `;
        });

        document.getElementById('res_area').style.display = "block";
    }
</script>

</body>
</html>
