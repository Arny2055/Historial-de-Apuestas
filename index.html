<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronosticador Doble An√°lisis + Kelly</title>
    <style>
        /* --- Estilos Generales --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0; 
            padding: 10px;
            background-color: #f0f0f5; 
        }
        h1 {
            font-size: 1.4em;
            text-align: center;
            margin-bottom: 5px;
            color: #333;
        }
        p {
            font-size: 0.9em;
            text-align: center;
            margin-bottom: 20px;
            color: #555;
            padding: 0 10px;
        }

        /* --- Estilos de Input --- */
        input[type="number"] {
            width: 95%;
            padding: 8px 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9em;
            -webkit-appearance: none; 
            box-sizing: border-box;
        }
        .cuota-bookie-input {
            font-weight: bold;
            color: #00897b;
        }

        /* --- Colores de Recomendaci√≥n --- */
        .recomendacion-box {
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            margin-top: 5px;
            display: block;
            line-height: 1.4;
        }
        .apostar-ev { 
            background-color: #388e3c; 
            color: white; 
        } 
        .no-apostar { 
            background-color: #f44336; 
            color: white; 
        } 
        
        /* Estilos de Contenido dentro del Box */
        .detalle-final, .cuota-esperar, .stake-final {
            display: block;
            font-weight: normal;
            margin-top: 5px;
            color: rgba(255, 255, 255, 0.9);
        }
        .stake-final {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffeb3b; 
        }
        .cuota-esperar {
            font-size: 0.9em;
            font-weight: bold;
            color: #ffeb3b; 
        }
        .tiempo-espera {
            font-size: 0.85em;
            font-weight: bold;
            color: #bdbdbd;
            display: block;
        }

        /* --- Estilos de Tabla (Modo Tarjeta) --- */
        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: white;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        thead { display: none; }
        tr {
            display: block;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        td {
            display: flex; 
            padding: 10px;
            border: none;
            border-bottom: 1px solid #eee;
            align-items: center;
            justify-content: space-between;
            font-size: 0.9em;
        }
        td::before {
            content: attr(data-label); 
            font-weight: bold;
            color: #1a73e8;
            flex-basis: 60%; 
            text-align: left;
        }
        tr td:first-child {
            background-color: #00bcd4;
            color: white;
            justify-content: center;
            font-size: 1.1em;
            padding: 12px 10px;
        }
        tr td:first-child::before {
            content: ""; 
        }
        .resultado-final {
            display: block; 
            text-align: center;
            border-bottom: none;
        }
    </style>
</head>
<body>

    <h1>‚öΩ Herramienta de An√°lisis de Valor (+EV)</h1>
    <p>El Gol HT usa la probabilidad de minutos para el c√°lculo de su valor.</p>

    <table id="pronosticador-universal">
        <tbody>
            <tr data-mercado="universal">
                <td data-label="">**1. An√°lisis Universal (Cualquier Mercado)**</td>
                <td data-label="Prob. BetMines (60% Peso)">
                    <input type="number" min="0" max="100" oninput="calcularPronostico('universal')" id="propia-universal" placeholder="60% Prob.">
                </td>
                <td data-label="Cuota Bookie (Decimal)">
                    <input type="number" step="0.01" min="1.01" oninput="calcularPronostico('universal')" id="bookie-universal" class="cuota-bookie-input" placeholder="Cuota Real">
                </td>
                <td data-label="Est. Valor Local (20% Peso)">
                    <input type="number" min="0" max="100" oninput="calcularPronostico('universal')" id="estl-universal" placeholder="20% L">
                </td>
                <td data-label="Est. Valor Visita (20% Peso)">
                    <input type="number" min="0" max="100" oninput="calcularPronostico('universal')" id="estv-universal" placeholder="20% V">
                </td>
                <td data-label="Resultado y Stake" class="resultado-final">
                    <span id="resultado-universal" class="recomendacion-box">Esperando datos...</span>
                </td>
            </tr>
        </tbody>
    </table>

    <table id="pronosticador-golht">
        <tbody>
            <tr data-mercado="golht">
                <td data-label="">**2. An√°lisis Gol en 1er Tiempo**</td>
                <td data-label="Prob. BetMines (60% Peso)">
                    <input type="number" min="0" max="100" oninput="calcularPronostico('golht')" id="propia-golht" placeholder="60% Prob.">
                </td>
                <td data-label="Cuota Bookie (Decimal)">
                    <input type="number" step="0.01" min="1.01" oninput="calcularPronostico('golht')" id="bookie-golht" class="cuota-bookie-input" placeholder="Cuota Real">
                </td>
                <td data-label="Prob. Minutos Goles (40% Peso)">
                    <input type="number" min="0" max="100" oninput="calcularPronostico('golht')" id="minutos-golht" placeholder="40% (Suma 0-45)">
                </td>
                <td data-label="Est. Valor Visita (0% Peso)">
                    <input type="number" min="0" max="100" disabled value="0" placeholder="0% V">
                </td>
                <td data-label="Resultado y Stake" class="resultado-final">
                    <span id="resultado-golht" class="recomendacion-box">Esperando datos...</span>
                </td>
            </tr>
        </tbody>
    </table>

    <script>
        // --- Constantes de Gesti√≥n de Riesgo ---
        const BANKROLL = 100; 
        const KELLY_FRACTION = 0.15; 
        
        // Pesos de Ponderaci√≥n Universal
        const PESO_PROPIA_UNIV = 0.60;
        const PESO_EST_UNIV = 0.20; 

        // Pesos de Ponderaci√≥n GOL HT
        const PESO_PROPIA_HT = 0.60;
        const PESO_MINUTOS_HT = 0.40;

        // --- FUNCIONES L√ìGICAS ---

        // Funci√≥n para determinar el tiempo prudente de espera
        function determinarTiempoEspera(probabilidadFinal, mercado) {
            // La l√≥gica de tiempo es m√°s cr√≠tica en Gol HT, as√≠ que la ajustamos ligeramente.
            if (mercado === 'golht') {
                if (probabilidadFinal >= 76) {
                    return "Minuto 25 - 35 (Si el marcador sigue 0-0)";
                } else if (probabilidadFinal >= 56) {
                    return "Minuto 15 - 25 (Si el marcador sigue 0-0)";
                } else {
                    return "Al inicio o Minuto 10";
                }
            } else { // Mercado Universal (basado en FT)
                if (probabilidadFinal >= 76) {
                    return "Minuto 60 - 70 (Si el marcador sigue sin goles)";
                } else if (probabilidadFinal >= 56) {
                    return "Descanso (Minuto 45)";
                } else if (probabilidadFinal >= 30) {
                    return "Minuto 15 - 30";
                } else {
                    return "Evaluar al inicio (Probabilidad Baja)";
                }
            }
        }

        // Funci√≥n principal de c√°lculo
        function calcularPronostico(mercado) {
            
            const resultadoSpan = document.getElementById(`resultado-${mercado}`);
            let inputs;
            let puntuacionFinal;

            if (mercado === 'golht') {
                // 1. Obtenci√≥n de Inputs GOL HT
                inputs = {
                    propia: parseFloat(document.getElementById(`propia-${mercado}`).value),
                    bookie: parseFloat(document.getElementById(`bookie-${mercado}`).value),
                    minutos: parseFloat(document.getElementById(`minutos-${mercado}`).value) // Nuevo campo
                };
                
                // 2. Validaci√≥n GOL HT
                let todosValidos = !isNaN(inputs.propia) && inputs.propia > 0 && inputs.propia <= 100 &&
                                   !isNaN(inputs.bookie) && inputs.bookie >= 1.01 &&
                                   !isNaN(inputs.minutos) && inputs.minutos > 0 && inputs.minutos <= 100;
                
                if (!todosValidos) {
                    resultadoSpan.innerHTML = 'Datos HT incompletos o inv√°lidos.';
                    resultadoSpan.className = 'recomendacion-box'; 
                    return;
                }

                // 3. C√°lculo de Probabilidad Ponderada GOL HT
                puntuacionFinal = 
                    (inputs.propia * PESO_PROPIA_HT) + 
                    (inputs.minutos * PESO_MINUTOS_HT);

            } else { // Mercado Universal (universal)
                 // 1. Obtenci√≥n de Inputs Universal
                inputs = {
                    propia: parseFloat(document.getElementById(`propia-${mercado}`).value),
                    bookie: parseFloat(document.getElementById(`bookie-${mercado}`).value),
                    estl: parseFloat(document.getElementById(`estl-${mercado}`).value),
                    estv: parseFloat(document.getElementById(`estv-${mercado}`).value)
                };

                 // 2. Validaci√≥n Universal
                let todosValidos = !isNaN(inputs.propia) && inputs.propia > 0 && inputs.propia <= 100 &&
                                   !isNaN(inputs.bookie) && inputs.bookie >= 1.01 &&
                                   !isNaN(inputs.estl) && inputs.estl > 0 && inputs.estl <= 100 &&
                                   !isNaN(inputs.estv) && inputs.estv > 0 && inputs.estv <= 100;

                if (!todosValidos) {
                    resultadoSpan.innerHTML = 'Datos Universal incompletos o inv√°lidos.';
                    resultadoSpan.className = 'recomendacion-box'; 
                    return;
                }
                
                // 3. C√°lculo de Probabilidad Ponderada Universal
                puntuacionFinal = 
                    (inputs.propia * PESO_PROPIA_UNIV) + 
                    (inputs.estl * PESO_EST_UNIV) + 
                    (inputs.estv * PESO_EST_UNIV);
            }
            
            puntuacionFinal = Math.round(puntuacionFinal * 10) / 10;
            
            // 4. C√°lculo de Cuota Justa (CJ)
            const cuotaJusta = (100 / puntuacionFinal);
            const cuotaJustaDisplay = cuotaJusta.toFixed(2); 

            // 5. C√ÅLCULO DE VALOR ESPERADO (EV)
            const probDecimal = puntuacionFinal / 100;
            const ev = (probDecimal * inputs.bookie) - 1;
            const evDisplay = (ev * 100).toFixed(2); 

            let recomendacion = '';
            let clase = 'recomendacion-box '; 
            let stakeDisplay = '0.00';
            let mensajeCuotaEsperar = '';
            let tiempoEspera = determinarTiempoEspera(puntuacionFinal, mercado);

            // 6. DECISI√ìN FINAL BASADA EN EV Y C√ÅLCULO KELLY
            if (inputs.bookie > cuotaJusta) {
                // EV POSITIVO: ¬°Es una apuesta de valor!
                
                // C√°lculo de Kelly Fraccional
                const v = ev; 
                const b = inputs.bookie - 1; 
                const kellyFraction = (v / b); 
                
                let stake = BANKROLL * kellyFraction * KELLY_FRACTION;
                
                if (stake <= 0 || isNaN(stake)) { 
                    stake = 0;
                }
                
                stakeDisplay = stake.toFixed(2);

                recomendacion = `‚úÖ APOSTAR (+EV ${evDisplay}%)`;
                clase += 'apostar-ev';

            } else {
                // EV NEGATIVO: No hay valor
                recomendacion = `‚ùå NO APOSTAR (-EV o Cuota Baja)`;
                clase += 'no-apostar';
                
                // Mensaje de Cuota a esperar y el tiempo
                mensajeCuotaEsperar = `<span class="cuota-esperar">üéØ Esperar cuota ‚â• ${cuotaJustaDisplay}</span>`;
                mensajeCuotaEsperar += `<span class="tiempo-espera">‚è≥ Buscar entre: ${tiempoEspera}</span>`;
            }
            
            // 7. Actualizar Resultado y Stake
            const detalle = `Prob. Final: ${puntuacionFinal}% | Cuota Justa: ${cuotaJustaDisplay}`;
            
            if (inputs.bookie > cuotaJusta) {
                resultadoSpan.innerHTML = `
                    ${recomendacion}
                    <span class="stake-final">Stake: ${stakeDisplay} U.</span>
                    <span class="detalle-final">${detalle}</span>
                `;
            } else {
                 resultadoSpan.innerHTML = `
                    ${recomendacion}
                    <span class="stake-final">Stake: ${stakeDisplay} U.</span>
                    ${mensajeCuotaEsperar}
                    <span class="detalle-final">${detalle}</span>
                `;
            }
            
            resultadoSpan.className = clase;
        }
    </script>
</body>
</html>
