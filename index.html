<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking de Profit BTTS por Equipo</title>
    <style>
        /* --- Estilos M√≥viles y Generales --- */
        body { font-family: sans-serif; margin: 0; padding: 10px; background-color: #f4f7f6; font-size: 16px; }
        .container { width: 100%; max-width: none; margin: 0 auto; background: white; padding: 15px; border-radius: 0; box-shadow: none; }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 8px; font-size: 1.5em; }
        
        /* --- Estilos de Entrada --- */
        .data-input { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        input[type="file"], button { width: 100%; padding: 12px 10px; margin-top: 10px; font-size: 1em; border-radius: 4px; }
        button.primary { background-color: #2ecc71; color: white; border: none; font-weight: bold; cursor: pointer; }
        button.primary:hover { background-color: #27ae60; }
        
        /* --- Estilos de Tablas de Resultados --- */
        .ranking-output { margin-top: 20px; padding: 15px; background-color: #f0f8ff; border-radius: 4px; }
        .ranking-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; display: block; overflow-x: auto; }
        .ranking-table th, .ranking-table td { 
            border: 1px solid #ddd; padding: 8px 6px; text-align: right; 
            white-space: nowrap; /* Evita que los n√∫meros se rompan */
        }
        .ranking-table th { background-color: #0056b3; color: white; text-align: center; }
        .ranking-table td:first-child { text-align: left; } /* Nombres de equipo a la izquierda */
        
        /* --- Indicadores de Profit --- */
        .positive { color: #27ae60; font-weight: bold; }
        .negative { color: #e74c3c; font-weight: bold; }
        .zero { color: #34495e; }
        .error { color: #e74c3c; font-weight: bold; }

        @media (max-width: 600px) {
            .ranking-table th, .ranking-table td { font-size: 0.75em; padding: 4px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>üí∞ Ranking de Rentabilidad (Profit) BTTS</h2>
        <p>Calcula el Profit Neto y el Yield (retorno de inversi√≥n) de cada equipo, separando su condici√≥n de local y visitante, asumiendo una apuesta de 1 unidad por partido.</p>

        <div class="data-input">
            <h4>Paso 1: Carga el Archivo JSON</h4>
            <input type="file" id="jsonFile" accept=".json">
            
            <button class="primary" onclick="iniciarCalculoProfit()">
                Calcular Ranking de Profit BTTS
            </button>
        </div>
        
        <div id="rankingOutput" class="ranking-output">
            <h4>Clasificaci√≥n de Rendimiento BTTS</h4>
            <p>Los resultados de Profit y Yield se mostrar√°n aqu√≠.</p>
        </div>
    </div>

    <script>
        // Variable para guardar los datos del archivo una vez cargado
        let globalMatchData = [];

        // --- FUNCI√ìN PRINCIPAL DE C√ÅLCULO DE PROFIT ---

        function iniciarCalculoProfit() {
            const fileInput = document.getElementById('jsonFile');
            const outputDiv = document.getElementById('rankingOutput');
            outputDiv.innerHTML = '<h4>Calculando Ranking...</h4>';

            if (fileInput.files.length === 0) {
                outputDiv.innerHTML = '<p class="error">‚ùå Por favor, selecciona un archivo JSON.</p>';
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    globalMatchData = JSON.parse(e.target.result);
                    procesarDatosProfit(outputDiv);
                } catch (error) {
                    outputDiv.innerHTML = `<p class="error">‚ùå Error al cargar/parsear JSON: ${error.message}</p>`;
                }
            };

            reader.onerror = function() {
                outputDiv.innerHTML = '<p class="error">‚ùå Error al leer el archivo.</p>';
            };

            reader.readAsText(fileInput.files[0]);
        }

        function procesarDatosProfit(outputDiv) {
            if (globalMatchData.length === 0) {
                outputDiv.innerHTML = '<p class="error">‚ùå El archivo JSON est√° vac√≠o.</p>';
                return;
            }

            // Estructura de datos para acumular el rendimiento por equipo y condici√≥n
            const teamPerformance = {};
            
            globalMatchData.forEach(item => {
                const match = item['Match'];
                const odd = parseFloat(item['Odd']);
                const result = item['Result']; // 'Winning' o 'Losing'

                if (!match || isNaN(odd) || !result) return;

                const parts = match.split('-').map(s => s.trim());
                if (parts.length < 2) return;

                const localTeam = parts[0];
                const awayTeam = parts[1];

                // Calculamos el profit o p√©rdida por la apuesta BTTS (asumiendo 1 unidad apostada)
                let profit = 0;
                if (result === 'Winning') {
                    // Si gana, el profit es la cuota - 1
                    profit = odd - 1; 
                } else if (result === 'Losing') {
                    // Si pierde, la p√©rdida es -1 unidad
                    profit = -1;
                }

                // 1. Acumular rendimiento del Equipo Local
                if (!teamPerformance[localTeam]) {
                    teamPerformance[localTeam] = { L: { matches: 0, profit: 0 } };
                }
                teamPerformance[localTeam].L.matches++;
                teamPerformance[localTeam].L.profit += profit;

                // 2. Acumular rendimiento del Equipo Visitante
                if (!teamPerformance[awayTeam]) {
                    teamPerformance[awayTeam] = { V: { matches: 0, profit: 0 } };
                }
                if (!teamPerformance[awayTeam].V) {
                     teamPerformance[awayTeam].V = { matches: 0, profit: 0 };
                }
                teamPerformance[awayTeam].V.matches++;
                teamPerformance[awayTeam].V.profit += profit;
            });

            // 3. Generar las tablas de clasificaci√≥n
            mostrarRanking(teamPerformance, outputDiv);
        }

        // --- FUNCI√ìN DE VISUALIZACI√ìN DEL RANKING ---

        function mostrarRanking(performanceData, outputDiv) {
            const rankings = [];

            // A. Preparar datos para el ranking
            for (const team in performanceData) {
                const data = performanceData[team];

                // Local (L)
                if (data.L && data.L.matches > 0) {
                    const yieldL = (data.L.profit / data.L.matches) * 100;
                    rankings.push({
                        team: team,
                        condition: 'Local',
                        matches: data.L.matches,
                        profit: data.L.profit,
                        yield: yieldL
                    });
                }

                // Visitante (V)
                if (data.V && data.V.matches > 0) {
                    const yieldV = (data.V.profit / data.V.matches) * 100;
                    rankings.push({
                        team: team,
                        condition: 'Visitante',
                        matches: data.V.matches,
                        profit: data.V.profit,
                        yield: yieldV
                    });
                }
            }

            if (rankings.length === 0) {
                 outputDiv.innerHTML = '<p class="error">‚ùå No se pudo extraer suficiente informaci√≥n de Profit. Verifica los campos "Match", "Odd" y "Result".</p>';
                 return;
            }

            // B. Ordenar por Profit Neto (de mejor a peor)
            const sortedByProfit = [...rankings].sort((a, b) => b.profit - a.profit);

            // C. Ordenar por Yield (de mejor a peor)
            const sortedByYield = [...rankings].sort((a, b) => b.yield - a.yield);

            // D. Construir el HTML
            outputDiv.innerHTML = `
                <h4>ü•á Ranking de Equipos por Rentabilidad BTTS</h4>
                <p>Muestra el rendimiento de cada equipo cuando se realiza una apuesta de 1 unidad al **BTTS S√ç** en sus partidos.</p>
                <hr>
                
                <h5 style="color: #0056b3;">Clasificaci√≥n por PROFIT NETO (Total de Ganancias)</h5>
                ${createTableHTML(sortedByProfit, 'profit')}
                
                <h5 style="color: #2ecc71; margin-top: 25px;">Clasificaci√≥n por YIELD (Retorno de Inversi√≥n)</h5>
                ${createTableHTML(sortedByYield, 'yield')}
            `;
             
        }

        // --- FUNCI√ìN AUXILIAR PARA CREAR TABLA ---

        function createTableHTML(data, sortBy) {
            let html = `<table class="ranking-table">
                <thead>
                    <tr>
                        <th style="text-align: left;">Equipo</th>
                        <th>Condici√≥n</th>
                        <th>Partidos</th>
                        <th>Profit Neto</th>
                        <th>Yield (%)</th>
                    </tr>
                </thead>
                <tbody>`;

            data.forEach(item => {
                const profitClass = item.profit > 0 ? 'positive' : item.profit < 0 ? 'negative' : 'zero';
                const yieldClass = item.yield > 0 ? 'positive' : item.yield < 0 ? 'negative' : 'zero';

                html += `
                    <tr>
                        <td style="font-weight: bold;">${item.team}</td>
                        <td>${item.condition}</td>
                        <td>${item.matches}</td>
                        <td class="${profitClass}">${item.profit.toFixed(2)}u</td>
                        <td class="${yieldClass}">${item.yield.toFixed(2)}%</td>
                    </tr>
                `;
            });

            html += `</tbody></table>`;
            return html;
        }
    </script>
</body>
</html>