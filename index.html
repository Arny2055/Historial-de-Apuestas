<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Varianza y Estrategia de Cuotas por Equipo</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f7f6; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .data-input, .simulation-output, .team-stats { margin-top: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 4px; }
        .team-stats { background-color: #ecf0f1; }
        select, button { padding: 10px; margin-right: 15px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer; }
        button { background-color: #2ecc71; color: white; border: none; font-weight: bold; }
        button:hover { background-color: #27ae60; }
        .result-box { margin-top: 20px; padding: 15px; border-left: 5px solid #3498db; background-color: #f0f8ff; }
        .range-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .range-table th, .range-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .range-table th { background-color: #3498db; color: white; }
        .error { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2>⚽ Simulador de Varianza de Equipos y Cuotas</h2>
        <p>Este simulador usa una muestra de datos (Goles Anotados/Recibidos) para calcular la varianza y simular el valor de cuotas en un enfrentamiento.</p>

        <div class="data-input">
            <p>Selecciona los equipos para la simulación (Local vs Visitante):</p>
            <select id="localTeam"></select>
            <span>vs</span>
            <select id="awayTeam"></select>
            <button onclick="simularPartido()">Simular Partido y Generar Estrategia</button>
        </div>

        <div id="teamStats" class="team-stats">
            <h4>Estadísticas y Varianza de los Equipos</h4>
            <p>Selecciona los equipos arriba para ver su análisis de varianza.</p>
        </div>

        <div id="simulationOutput" class="simulation-output" style="display: none;">
            <h4>Resultados de la Simulación</h4>
        </div>
    </div>

    <script>
        // --- 1. DATOS DE EJEMPLO (Simulando tu Backtesting) ---
        // 'GA' = Goles Anotados por partido, 'GR' = Goles Recibidos por partido
        const teamData = {
            "Manchester City": {
                name: "Manchester City",
                posicion: 1,
                ga: [3, 2, 4, 1, 3, 2, 2, 5, 1, 3], // 10 partidos
                gr: [1, 0, 0, 1, 1, 0, 1, 2, 0, 1]
            },
            "Aston Villa": {
                name: "Aston Villa",
                posicion: 5,
                ga: [1, 2, 0, 3, 1, 2, 1, 0, 2, 1],
                gr: [1, 1, 2, 1, 1, 0, 2, 1, 1, 1]
            },
            "Chelsea": {
                name: "Chelsea",
                posicion: 10,
                ga: [0, 1, 2, 1, 1, 0, 2, 3, 1, 0],
                gr: [3, 2, 1, 1, 2, 1, 0, 1, 3, 2]
            },
            "Luton Town": {
                name: "Luton Town",
                posicion: 18,
                ga: [0, 1, 0, 2, 1, 0, 1, 1, 0, 2],
                gr: [4, 3, 2, 2, 1, 3, 2, 2, 3, 1]
            }
        };

        // --- 2. FUNCIONES DE CÁLCULO ESTADÍSTICO ---
        
        function calcularMedia(datos) {
            if (datos.length === 0) return 0;
            const suma = datos.reduce((acc, val) => acc + val, 0);
            return suma / datos.length;
        }

        function calcularVarianza(datos) {
            const n = datos.length;
            if (n < 2) return 0;
            const media = calcularMedia(datos);
            
            const sumatoria = datos.reduce((acc, val) => {
                const diferencia = val - media;
                return acc + (diferencia * diferencia);
            }, 0);
            
            // Varianza Muestral
            return sumatoria / (n - 1); 
        }

        // --- 3. ANÁLISIS POR EQUIPO ---

        function analizarVarianzaEquipo(team) {
            const varGA = calcularVarianza(team.ga);
            const varGR = calcularVarianza(team.gr);
            const mediaGA = calcularMedia(team.ga);
            const mediaGR = calcularMedia(team.gr);

            return {
                varGA: varGA.toFixed(3),
                varGR: varGR.toFixed(3),
                mediaGA: mediaGA.toFixed(2),
                mediaGR: mediaGR.toFixed(2)
            };
        }

        function displayTeamStats(teamName) {
            const team = teamData[teamName];
            if (!team) return;

            const stats = analizarVarianzaEquipo(team);
            const outputDiv = document.getElementById('teamStats');
            
            outputDiv.innerHTML = `
                <h4>Análisis de Varianza de ${team.name} (Posición: ${team.posicion})</h4>
                <p><strong>Media Goles Anotados (GA):</strong> ${stats.mediaGA}</p>
                <p><strong>Media Goles Recibidos (GR):</strong> ${stats.mediaGR}</p>
                <p><strong>Varianza Ofensiva (GA):</strong> <strong>${stats.varGA}</strong> (Indica cuánto varían sus goles anotados por partido)</p>
                <p><strong>Varianza Defensiva (GR):</strong> <strong>${stats.varGR}</strong> (Indica cuánto varían sus goles recibidos por partido)</p>
                <p><strong>Interpretación:</strong> ${parseFloat(stats.varGA) > 1.0 ? 'Varianza Ofensiva ALTA: Resultados ofensivos inconsistentes.' : 'Varianza Ofensiva BAJA: Resultados ofensivos consistentes.'}</p>
                <p><strong>Interpretación:</strong> ${parseFloat(stats.varGR) > 1.0 ? 'Varianza Defensiva ALTA: Resultados defensivos inconsistentes.' : 'Varianza Defensiva BAJA: Resultados defensivos consistentes.'}</p>
            `;
        }
        
        // --- 4. SIMULACIÓN DE PARTIDO Y ESTRATEGIA DE CUOTAS ---

        function simularPartido() {
            const localName = document.getElementById('localTeam').value;
            const awayName = document.getElementById('awayTeam').value;
            const outputDiv = document.getElementById('simulationOutput');
            outputDiv.style.display = 'block';

            if (localName === awayName) {
                outputDiv.innerHTML = '<p class="error">❌ No puedes seleccionar el mismo equipo para Local y Visitante.</p>';
                return;
            }

            const local = teamData[localName];
            const away = teamData[awayName];

            const localStats = analizarVarianzaEquipo(local);
            const awayStats = analizarVarianzaEquipo(away);
            
            // ----------------------------------------------------
            // LÓGICA DE PREDICCIÓN (Simulación de tu Modelo Posicional)
            // Aquí se simula una predicción basada en el rendimiento y la varianza
            // ----------------------------------------------------
            
            // Factor de la fuerza ofensiva/defensiva (basado en medias)
            const factorLocal = parseFloat(localStats.mediaGA) + (parseFloat(awayStats.mediaGR) * 0.5);
            const factorAway = parseFloat(awayStats.mediaGA) + (parseFloat(localStats.mediaGR) * 0.5);
            
            // El 'Edge' de la apuesta es la diferencia entre los factores
            const rawEdge = Math.abs(factorLocal - factorAway); 
            
            // ----------------------------------------------------
            // ESTIMACIÓN DE PROBABILIDAD (Modelo Simplificado)
            // ----------------------------------------------------

            let probLocal = 0.33 + (factorLocal / (factorLocal + factorAway)) * 0.33; // ~66% de la prob. total
            let probAway = 0.33 + (factorAway / (factorLocal + factorAway)) * 0.33;
            
            if (probLocal > 0.9) probLocal = 0.8; // Clamp para evitar extremos
            if (probAway > 0.9) probAway = 0.8;
            
            let probEmpate = 1 - probLocal - probAway; 
            
            // Aplicar Varianza: Si la varianza ofensiva o defensiva de los equipos es alta (>1.0),
            // se aumenta la probabilidad de resultados atípicos (goles y empates), reduciendo
            // ligeramente la probabilidad de victoria directa.
            if (parseFloat(localStats.varGA) > 1.0 || parseFloat(awayStats.varGR) > 1.0) {
                 probEmpate += 0.05; // Más chance de empate o sorpresa
            }
            
            // Normalizar las probabilidades
            const totalProb = probLocal + probAway + probEmpate;
            probLocal /= totalProb;
            probAway /= totalProb;
            probEmpate /= totalProb;
            
            // ----------------------------------------------------
            // GENERACIÓN DE CUOTAS 'JUSTAS' Y ESTRATEGIA
            // ----------------------------------------------------

            const cuotaJustaLocal = 1 / probLocal;
            const cuotaJustaAway = 1 / probAway;
            const cuotaJustaEmpate = 1 / probEmpate;
            
            // RANGO DE CUOTAS PARA EL EDGE (Basado en la cuota justa)
            // Se asume que tu apuesta busca un 5% de Edge sobre la cuota justa
            const cuotaRecomendadaLocal = cuotaJustaLocal * 0.95; // Si la casa ofrece más que esto, es valor
            const cuotaRecomendadaAway = cuotaJustaAway * 0.95;
            
            // Rango de la Cuota 1 (Local)
            const r1Min = cuotaJustaLocal * 1.05; // Cuotas bajas (favorito)
            const r1Max = cuotaJustaLocal * 1.25;
            
            // Rango de Cuota 2 (Visitante) o Underdog
            const r2Min = cuotaJustaAway * 0.70; // Cuotas altas (Underdog)
            const r2Max = cuotaJustaAway * 0.90; 

            // Mostrar Resultados
            outputDiv.innerHTML = `
                <h4>Previsión de Probabilidad (Modelo Simplificado)</h4>
                <p>Victoria ${local.name} (1): <strong>${(probLocal * 100).toFixed(2)}%</strong> (Cuota Justa: ${cuotaJustaLocal.toFixed(2)})</p>
                <p>Empate (X): <strong>${(probEmpate * 100).toFixed(2)}%</strong> (Cuota Justa: ${cuotaJustaEmpate.toFixed(2)})</p>
                <p>Victoria ${away.name} (2): <strong>${(probAway * 100).toFixed(2)}%</strong> (Cuota Justa: ${cuotaJustaAway.toFixed(2)})</p>
                
                <hr>

                ${generarEstrategiaTabla(cuotaJustaLocal, cuotaJustaAway, localStats, awayStats)}
            `;
        }
        
        function generarEstrategiaTabla(cuotaLocal, cuotaAway, localStats, awayStats) {
            
            let esApostarA = (cuotaLocal < cuotaAway) ? `La ventaja está en ${teamData[document.getElementById('localTeam').value].name} (1)` : `La ventaja está en ${teamData[document.getElementById('awayTeam').value].name} (2)`;
            
            const localIsVolatile = parseFloat(localStats.varGA) > 1.0 || parseFloat(localStats.varGR) > 1.0;
            const awayIsVolatile = parseFloat(awayStats.varGA) > 1.0 || parseFloat(awayStats.varGR) > 1.0;
            
            let comentarioVarianza = '';
            if (localIsVolatile && awayIsVolatile) {
                comentarioVarianza = 'Ambos equipos son **volátiles**. Es alta la probabilidad de resultados atípicos (goles y sorpresas). Considera mercados de Goles o Hándicap.';
            } else if (localIsVolatile) {
                comentarioVarianza = `${teamData[document.getElementById('localTeam').value].name} es volátil. El mercado de **Goles** o **Empate/Victoria Visitante** puede ofrecer valor si la cuota es atractiva.`;
            } else if (awayIsVolatile) {
                comentarioVarianza = `${teamData[document.getElementById('awayTeam').value].name} es volátil. El mercado de **Goles** o **Empate/Victoria Local** puede ofrecer valor.`;
            } else {
                 comentarioVarianza = 'Ambos equipos son **consistentes**. La predicción de cuotas es más confiable. El valor se encontrará en una pequeña diferencia.';
            }

            return `
                <h4>Estrategia de Cuotas Sugeridas (Basado en Varianza y Edge)</h4>
                <p>Tu análisis sugiere que: ${esApostarA}</p>
                <p style="font-weight: bold;">Interpretación de Varianza: ${comentarioVarianza}</p>

                <table class="range-table">
                    <thead>
                        <tr>
                            <th>Mercado</th>
                            <th>Rango de Cuotas Sugerido</th>
                            <th>Estrategia de Valor (Edge)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Victoria Directa (${teamData[document.getElementById('localTeam').value].name})</td>
                            <td>**${(cuotaLocal * 1.05).toFixed(2)}** o **MÁS**</td>
                            <td>Si la casa ofrece una cuota ${cuotaLocal.toFixed(2)} + 5% o más, ¡es un valor fuerte (Edge positivo)!</td>
                        </tr>
                        <tr>
                            <td>Victoria Directa (${teamData[document.getElementById('awayTeam').value].name})</td>
                            <td>**${(cuotaAway * 1.05).toFixed(2)}** o **MÁS**</td>
                            <td>Si ${teamData[document.getElementById('awayTeam').value].name} es el *underdog*, busca cuotas que superen ${cuotaAway.toFixed(2)} + 5%.</td>
                        </tr>
                        <tr>
                            <td>**Ambos Anotan (BTTS)**</td>
                            <td>**1.85 - 2.10**</td>
                            <td>Si la varianza ofensiva/defensiva es alta en ambos equipos, busca cuotas cercanas o superiores a 2.00 para BTTS.</td>
                        </tr>
                        <tr>
                            <td>**Hándicap/Goles**</td>
                            <td>**1.90 - 2.20**</td>
                            <td>Si un equipo es muy volátil, es más seguro apostar a hándicaps (ej: +1.5) o Over/Under Goles.</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
        }
        
        // --- 5. INICIALIZACIÓN ---

        function init() {
            const localSelect = document.getElementById('localTeam');
            const awaySelect = document.getElementById('awayTeam');

            Object.keys(teamData).forEach(teamName => {
                const optionLocal = document.createElement('option');
                optionLocal.value = teamName;
                optionLocal.textContent = teamName;
                localSelect.appendChild(optionLocal);

                const optionAway = document.createElement('option');
                optionAway.value = teamName;
                optionAway.textContent = teamName;
                awaySelect.appendChild(optionAway);
            });
            
            // Listener para actualizar las estadísticas al cambiar la selección
            localSelect.addEventListener('change', (e) => displayTeamStats(e.target.value));
            awaySelect.addEventListener('change', (e) => displayTeamStats(e.target.value));
            
            // Muestra estadísticas del primer equipo por defecto
            displayTeamStats(Object.keys(teamData)[0]);
        }
        
        window.onload = init;
    </script>
</body>
</html>
