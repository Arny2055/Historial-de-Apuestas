<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Predictor - Entrenamiento de Patrones</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #238636; --text: #c9d1d9; --gold: #d29922; --win: #2ea043; --loss: #f85149; --info: #58a6ff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: 1fr 450px; gap: 20px; }
        textarea { width: 100%; height: 150px; background: #010409; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 6px; box-sizing: border-box; font-family: monospace; }
        .panel { background: var(--card); border: 1px solid #30363d; border-radius: 6px; padding: 20px; margin-bottom: 20px; }
        button { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        button.predict-btn { background: var(--info); margin-top: 10px; }
        .prediction-box { padding: 20px; border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold; display: none; }
        .bet-yes { background: rgba(46, 160, 67, 0.2); border: 2px solid var(--win); color: #7ee787; }
        .bet-no { background: rgba(248, 81, 73, 0.2); border: 2px solid var(--loss); color: #ffa198; }
        input { background: #0d1117; border: 1px solid #30363d; color: white; padding: 8px; border-radius: 4px; width: 60px; text-align: center; }
        .form-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9em; }
        .log-search { font-size: 0.8em; color: #8b949e; height: 80px; overflow-y: auto; background: #010409; padding: 10px; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" style="text-align:center;">
        <h2>üß† Predictor de Goles Entrenado</h2>
        <p>Entrena el modelo con tu historial y predice entradas en vivo</p>
    </div>

    <div class="grid">
        <div class="left-col">
            <div class="panel">
                <h3>1. Base de Conocimiento (Entrenamiento)</h3>
                <textarea id="dataInput" placeholder="Pega aqu√≠ los datos de todas las ligas para entrenar la herramienta..."></textarea>
                <button onclick="trainModel()">Entrenar Herramienta con Historial</button>
                <div id="trainLog" class="log-search">Modelo sin entrenar.</div>
            </div>

            <div class="panel">
                <h3>2. Auditor√≠a de Entrenamiento</h3>
                <div id="auditResults" style="font-size: 0.85em;">Carga datos para ver la efectividad por rangos.</div>
            </div>
        </div>

        <div class="right-col">
            <div class="panel" style="border-color: var(--info);">
                <h3>üéØ Datos del Partido en Vivo</h3>
                
                <div class="form-row">
                    <span>Posici√≥n Ranking:</span>
                    <div><input type="number" id="rankH" value="10"> - <input type="number" id="rankA" value="18"></div>
                </div>
                <div class="form-row">
                    <span>Ataques Peligrosos:</span>
                    <div><input type="number" id="apH" value="3"> - <input type="number" id="apA" value="10"></div>
                </div>
                <div class="form-row">
                    <span>Tiros a Puerta:</span>
                    <div><input type="number" id="shOnH" value="0"> - <input type="number" id="shOnA" value="1"></div>
                </div>
                <div class="form-row">
                    <span>C√≥rners:</span>
                    <div><input type="number" id="crnH" value="0"> - <input type="number" id="crnA" value="1"></div>
                </div>
                <div class="form-row">
                    <span>% Ataques:</span>
                    <div><input type="number" id="atH" value="53">% - <input type="number" id="atA" value="47">%</div>
                </div>

                <button class="predict-btn" onclick="predictBet()">¬øAPOSTAR O NO?</button>

                <div id="predictionResult" class="prediction-box"></div>
                <div id="confidenceNote" style="text-align:center; font-size: 0.8em; margin-top: 10px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
let trainedData = [];
let modelTrained = false;

function trainModel() {
    const input = document.getElementById('dataInput').value;
    const lines = input.split('\n').filter(l => l.trim() !== "" && !l.toLowerCase().includes('match'));
    const log = document.getElementById('trainLog');
    
    if (lines.length < 5) {
        alert("Pega m√°s datos para un entrenamiento fiable.");
        return;
    }

    trainedData = [];
    lines.forEach(line => {
        const cols = line.split('\t');
        if (cols.length < 42) return;

        const ap = (parseInt(cols[11]) || 0) + (parseInt(cols[12]) || 0);
        const shOn = (parseInt(cols[15]) || 0) + (parseInt(cols[16]) || 0);
        const resultHT = cols[41].trim();
        const isWin = (resultHT !== "0-0" && resultHT !== "");

        trainedData.push({ ap, shOn, isWin });
    });

    modelTrained = true;
    log.innerHTML = `‚úÖ Entrenamiento completado.<br>Muestra analizada: ${trainedData.length} partidos.<br>Acierto global HT: ${((trainedData.filter(d=>d.isWin).length/trainedData.length)*100).toFixed(1)}%`;
}

function predictBet() {
    if (!modelTrained) {
        alert("Primero debes pegar los datos hist√≥ricos y hacer clic en 'Entrenar'.");
        return;
    }

    // Captura de datos live ingresados por el usuario
    const liveAP = parseInt(document.getElementById('apH').value) + parseInt(document.getElementById('apA').value);
    const liveSh = parseInt(document.getElementById('shOnH').value) + parseInt(document.getElementById('shOnA').value);
    
    const resultDiv = document.getElementById('predictionResult');
    const noteDiv = document.getElementById('confidenceNote');

    // L√≥gica de comparaci√≥n con el modelo entrenado
    // Buscamos partidos similares en la base de datos (+/- 20% de presi√≥n)
    const similarMatches = trainedData.filter(d => 
        d.ap >= (liveAP * 0.8) && d.ap <= (liveAP * 1.2) &&
        d.shOn >= liveSh
    );

    const wins = similarMatches.filter(m => m.win).length;
    const total = similarMatches.length;
    const prob = total > 0 ? (wins / total) : 0;

    resultDiv.style.display = "block";

    // Umbral de rentabilidad para cuota 1.60 (62.5%)
    if (prob >= 0.63 && total >= 3) {
        resultDiv.className = "prediction-box bet-yes";
        resultDiv.innerHTML = `Veredicto: ¬°APUESTA! ‚úÖ`;
        noteDiv.innerHTML = `Basado en ${total} partidos similares, la probabilidad de gol HT es del ${(prob*100).toFixed(1)}%.`;
    } else {
        resultDiv.className = "prediction-box bet-no";
        resultDiv.innerHTML = `Veredicto: NO APOSTAR ‚ùå`;
        noteDiv.innerHTML = `Probabilidad detectada: ${(prob*100).toFixed(1)}%. Insuficiente para cuota 1.60 o muestra muy peque√±a (${total}).`;
    }
}
</script>

</body>
</html>
