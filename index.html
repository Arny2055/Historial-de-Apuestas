<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poisson Pro - Valor y Mercados</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0e1621; color: #ffffff; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: auto; background: #17212b; padding: 30px; border-radius: 12px; border: 1px solid #2b3948; }
        h1, h2 { color: #52a8ff; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 20px; }
        .card { background: #242f3d; padding: 15px; border-radius: 8px; }
        .input-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        label { font-size: 0.9em; color: #abaeb3; margin-bottom: 5px; }
        input { padding: 10px; background: #0e1621; border: 1px solid #3d4b59; color: white; border-radius: 5px; }
        button { width: 100%; padding: 12px; background: #52a8ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1.1em; margin-top: 10px; }
        button:hover { background: #3d86d4; }
        #resultado { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; }
        .success { border-left: 5px solid #27ae60; background: #1c2e25; }
        .info-box { background: #2b3948; padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 0.85em; }
        table { width: 100%; margin-top: 15px; border-collapse: collapse; background: #17212b; }
        th, td { padding: 10px; border-bottom: 1px solid #2b3948; text-align: left; }
        .valor-alto { color: #27ae60; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>Estrategia de Valor Poisson</h1>
    
    <div class="info-box">
        <strong>üí° Recomendaci√≥n de Muestra:</strong> Para que Poisson sea fiable, usa los <strong>√∫ltimos 10 a 15 partidos</strong> de cada equipo. 
        Muestras menores a 5 partidos son ruidosas; m√°s de 25 no reflejan el estado de forma actual (fichajes, lesiones).
    </div>

    <div class="grid">
        <div class="card">
            <h3>üè† Equipo Local</h3>
            <div class="input-group">
                <label>Goles Proyectados (Ataque):</label>
                <input type="number" id="al" value="1.6" step="0.1">
            </div>
            <div class="input-group">
                <label>Cuota Local (Casa):</label>
                <input type="number" id="cl" value="2.00" step="0.01">
            </div>
        </div>
        <div class="card">
            <h3>üöÄ Equipo Visitante</h3>
            <div class="input-group">
                <label>Goles Proyectados (Ataque):</label>
                <input type="number" id="av" value="1.1" step="0.1">
            </div>
            <div class="input-group">
                <label>Cuota Over 2.5 (Casa):</label>
                <input type="number" id="co" value="1.95" step="0.01">
            </div>
        </div>
    </div>

    <button onclick="analizarTodo()">Calcular Mercados de Valor</button>

    <div id="resultado" class="success">
        <h2>An√°lisis de Probabilidades</h2>
        <table>
            <thead>
                <tr>
                    <th>Mercado</th>
                    <th>Prob. Real</th>
                    <th>Cuota Justa</th>
                    <th>EV (%)</th>
                </tr>
            </thead>
            <tbody id="tabla-body"></tbody>
        </table>
    </div>

    <div class="info-box" style="border-top: 2px solid #52a8ff;">
        <strong>üéØ ¬øPor qu√© Over/Under 2.5?</strong> El f√∫tbol es un deporte de baja anotaci√≥n. Poisson es excepcionalmente bueno prediciendo la suma de goles (frecuencia) m√°s que el ganador exacto, ya que elimina el sesgo psicol√≥gico del "qui√©n gana" y se enfoca en la capacidad ofensiva pura.
    </div>
</div>

<script>
    function factorial(n) {
        if (n === 0 || n === 1) return 1;
        let res = 1;
        for (let i = 2; i <= n; i++) res *= i;
        return res;
    }

    function poisson(k, lambda) {
        return (Math.pow(Math.E, -lambda) * Math.pow(lambda, k)) / factorial(k);
    }

    function analizarTodo() {
        const lambdaL = parseFloat(document.getElementById('al').value);
        const lambdaV = parseFloat(document.getElementById('av').value);
        const cuotaCasaL = parseFloat(document.getElementById('cl').value);
        const cuotaCasaO = parseFloat(document.getElementById('co').value);

        let pWinL = 0, pDraw = 0, pWinV = 0, pOver25 = 0;

        for (let i = 0; i <= 8; i++) {
            for (let j = 0; j <= 8; j++) {
                const prob = poisson(i, lambdaL) * poisson(j, lambdaV);
                
                // 1X2
                if (i > j) pWinL += prob;
                else if (i === j) pDraw += prob;
                else pWinV += prob;

                // Over 2.5
                if ((i + j) > 2.5) pOver25 += prob;
            }
        }

        const mercados = [
            { nombre: "Victoria Local (1)", prob: pWinL, cuotaCasa: cuotaCasaL },
            { nombre: "Over 2.5 Goles", prob: pOver25, cuotaCasa: cuotaCasaO }
        ];

        const tbody = document.getElementById('tabla-body');
        tbody.innerHTML = "";

        mercados.forEach(m => {
            const cJusta = 1 / m.prob;
            const ev = ((m.cuotaCasa / cJusta) - 1) * 100;
            const valorClass = ev > 0 ? "valor-alto" : "";

            tbody.innerHTML += `
                <tr>
                    <td>${m.nombre}</td>
                    <td>${(m.prob * 100).toFixed(1)}%</td>
                    <td>${cJusta.toFixed(2)}</td>
                    <td class="${valorClass}">${ev.toFixed(2)}%</td>
                </tr>
            `;
        });

        document.getElementById('resultado').style.display = "block";
    }
</script>

</body>
</html>
