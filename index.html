<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bot Optimizer - M√°ximo Rendimiento</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #238636; --text: #c9d1d9; --gold: #d29922; --win: #2ea043; --loss: #f85149; --info: #58a6ff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: 1fr 450px; gap: 20px; }
        textarea { width: 100%; height: 200px; background: #010409; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 6px; box-sizing: border-box; font-family: monospace; }
        .panel { background: var(--card); border: 1px solid #30363d; border-radius: 6px; padding: 20px; margin-bottom: 20px; }
        button { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        .predict-btn { background: var(--info) !important; margin-top: 10px; height: 50px; font-size: 1.1em; }
        .bot-config { background: #010409; border: 2px solid var(--gold); padding: 20px; border-radius: 8px; color: var(--gold); font-family: monospace; position: relative; }
        .roi-badge { position: absolute; top: 10px; right: 10px; background: var(--win); color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.9em; }
        .prediction-box { padding: 20px; border-radius: 8px; text-align: center; margin-top: 15px; font-weight: bold; display: none; border: 2px solid transparent; }
        .bet-yes { background: rgba(46, 160, 67, 0.2); border-color: var(--win); color: #7ee787; }
        .bet-no { background: rgba(248, 81, 73, 0.2); border-color: var(--loss); color: #ffa198; }
        .data-preview { background: #0d1117; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.85em; border: 1px dashed var(--info); }
        .search-log { font-size: 0.75em; color: #8b949e; height: 100px; overflow-y: auto; background: #000; padding: 10px; margin-top: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align:center; margin-bottom: 30px;">
        <h2>üöÄ AI High-Performance Bot Finder</h2>
        <p>Buscando el algoritmo con mayor ROI basado en tu entrenamiento</p>
    </div>

    <div class="grid">
        <div class="left-col">
            <div class="panel">
                <h3>1. Entrenamiento Masivo</h3>
                <textarea id="dataInput" placeholder="Pega aqu√≠ todo tu historial de ligas..."></textarea>
                <button onclick="findBestStrategy()" style="margin-top:10px;">Encontrar Estrategia de Mayor Rendimiento</button>
                <div id="searchLog" class="search-log">Esperando datos para iniciar optimizaci√≥n...</div>
            </div>

            <div id="bestBotDisplay" style="display:none;">
                <div class="panel">
                    <h3>üèÜ Estrategia Maestra Encontrada</h3>
                    <div id="botConfig" class="bot-config"></div>
                </div>
            </div>
        </div>

        <div class="right-col">
            <div class="panel" style="border-top: 4px solid var(--info);">
                <h3>üéØ Analizador Live Inteligente</h3>
                <p style="font-size: 0.85em;">Pega los datos del partido aqu√≠:</p>
                <textarea id="liveRawInput" style="height: 100px;" placeholder="Pega aqu√≠: Ranking, Goles, Tiros, AP..." oninput="parseLiveData()"></textarea>
                
                <div id="dataPreview" class="data-preview">Sin datos de entrada...</div>

                <button class="predict-btn" onclick="predictBet()">EJECUTAR PREDICCI√ìN</button>

                <div id="predictionResult" class="prediction-box"></div>
                <div id="confidenceNote" style="text-align:center; font-size: 0.8em; margin-top: 10px; color: #8b949e;"></div>
            </div>
        </div>
    </div>
</div>

<script>
let trainedData = [];
let bestParams = null;
let currentLiveStats = null;

function findBestStrategy() {
    const input = document.getElementById('dataInput').value;
    const lines = input.split('\n').filter(l => l.trim() !== "" && !l.toLowerCase().includes('match'));
    const log = document.getElementById('searchLog');
    
    if (lines.length < 10) {
        alert("Necesito al menos 10 partidos para encontrar un patr√≥n de alto rendimiento.");
        return;
    }

    trainedData = [];
    lines.forEach(line => {
        const cols = line.split('\t');
        if (cols.length < 42) return;
        trainedData.push({
            ap: (parseInt(cols[11]) || 0) + (parseInt(cols[12]) || 0),
            shOn: (parseInt(cols[15]) || 0) + (parseInt(cols[16]) || 0),
            crn: (parseInt(cols[27]) || 0) + (parseInt(cols[28]) || 0),
            min: parseInt(cols[7]) || 1,
            isWin: (cols[41].trim() !== "0-0" && cols[41].trim() !== "")
        });
    });

    log.innerHTML = "Iniciando B√∫squeda de Alto Rendimiento (Iterando 1,000+ combinaciones)...<br>";
    
    let maxROI = -100;
    
    // Bucle inteligente: Probar combinaciones de AP/Min, Tiros y C√≥rners
    for (let apM = 0.8; apM <= 2.2; apM += 0.2) {
        for (let sh = 0; sh <= 3; sh++) {
            for (let cr = 0; cr <= 3; cr++) {
                let sample = trainedData.filter(d => (d.ap/d.min) >= apM && d.shOn >= sh && d.crn >= cr);
                if (sample.length >= 5) {
                    let wins = sample.filter(s => s.isWin).length;
                    let roi = ((wins * 1.60 - sample.length) / sample.length * 100);
                    
                    if (roi > maxROI) {
                        maxROI = roi;
                        bestParams = { apM, sh, cr, roi, strike: (wins/sample.length)*100, n: sample.length };
                    }
                }
            }
        }
    }

    if (bestParams && bestParams.roi > 0) {
        displayBestBot();
        log.innerHTML += `<span style="color:var(--win)">¬°√âxito! ROI Encontrado: ${bestParams.roi.toFixed(1)}%</span>`;
    } else {
        log.innerHTML += `<span style="color:var(--loss)">No se hall√≥ patr√≥n rentable. Sube el AP/Min o cambia datos.</span>`;
    }
}

function displayBestBot() {
    document.getElementById('bestBotDisplay').style.display = "block";
    document.getElementById('botConfig').innerHTML = `
        <div class="roi-badge">ROI: ${bestParams.roi.toFixed(1)}%</div>
        <strong>CRITERIOS MAESTROS:</strong><br>
        1. AP / Minuto: > ${bestParams.apM.toFixed(1)}<br>
        2. Tiros a Puerta: >= ${bestParams.sh}<br>
        3. C√≥rners: >= ${bestParams.cr}<br>
        ----------------------------<br>
        Muestra: ${bestParams.n} partidos<br>
        Strike Rate: ${bestParams.strike.toFixed(1)}%
    `;
}

function parseLiveData() {
    const text = document.getElementById('liveRawInput').value;
    if (!text) return;

    const extract = (label) => {
        const reg = new RegExp(label + "[:\\s]*(\\d+)\\s*-\\s*(\\d+)", "i");
        const m = text.match(reg);
        return m ? { h: parseInt(m[1]), a: parseInt(m[2]), tot: parseInt(m[1]) + parseInt(m[2]) } : { h:0, a:0, tot:0 };
    };

    currentLiveStats = { ap: extract("peligrosos"), sh: extract("puerta"), cr: extract("corners") };
    document.getElementById('dataPreview').innerHTML = `
        AP: ${currentLiveStats.ap.tot} | Tiros: ${currentLiveStats.sh.tot} | Corners: ${currentLiveStats.cr.tot}
    `;
}

function predictBet() {
    if (!bestParams) { alert("Primero entrena y busca la mejor estrategia."); return; }
    
    const resDiv = document.getElementById('predictionResult');
    resDiv.style.display = "block";

    // Evaluar si los datos LIVE superan los filtros del MEJOR BOT encontrado
    // Asumimos un minuto promedio de 25 para el c√°lculo del AP en vivo si no se detecta
    const liveAPM = currentLiveStats.ap.tot / 25; 

    if (liveAPM >= bestParams.apM && currentLiveStats.sh.tot >= bestParams.sh && currentLiveStats.cr.tot >= bestParams.cr) {
        resDiv.className = "prediction-box bet-yes";
        resDiv.innerHTML = "¬°APUESTA DETECTADA! ‚úÖ";
        document.getElementById('confidenceNote').innerHTML = "Este partido cumple con el patr√≥n de m√°ximo ROI hist√≥rico.";
    } else {
        resDiv.className = "prediction-box bet-no";
        resDiv.innerHTML = "NO CUMPLE PATR√ìN ‚ùå";
        document.getElementById('confidenceNote').innerHTML = "La presi√≥n actual es inferior a la estrategia de mayor rendimiento.";
    }
}
</script>
</body>
</html>
