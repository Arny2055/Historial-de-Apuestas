<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Calculadora Poisson Bivariante - Entrada de Tablas</title>
    <style>
        /* Estilos Base (Mantenidos y Ajustados) */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0;
            background-color: #1a1a2e;
            color: #e0e0e0; 
            min-height: 100vh; 
            width: 100vw;
            display: flex;
            flex-direction: column; 
            justify-content: flex-start; 
            align-items: center;
        }
        .container { 
            width: 98vw; 
            max-width: 950px; 
            padding: 40px 30px; 
            margin-top: 15px; 
            margin-bottom: 15px; 
            background-color: #2c2c54; 
            border-radius: 20px; 
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.7); 
        }
        h2 { 
            text-align: center; 
            color: #ff9800;
            margin-bottom: 5px; 
            font-size: 2.2em; 
        }
        small {
            display: block;
            text-align: center;
            margin-bottom: 20px;
            color: #ccc;
        }
        .warning-text {
            color: #ff5722;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #3e3e6b;
            border-radius: 8px;
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600; 
            color: #f0f0f0;
            font-size: 1.1em; 
        }
        input[type="number"], select, textarea { 
            padding: 12px;
            margin-bottom: 15px; 
            width: 100%; 
            box-sizing: border-box; 
            border: 3px solid #4a4e69; 
            border-radius: 10px; 
            background-color: #3e3e6b; 
            color: #ffffff; 
            font-size: 1.1em;
            resize: vertical;
        }
        textarea {
            min-height: 150px;
            font-family: monospace;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
        }
        button { 
            padding: 15px; 
            background-color: #ff9800;
            color: #1a1a2e; 
            border: none; 
            border-radius: 10px; 
            width: 100%; 
            cursor: pointer; 
            font-size: 1.2em; 
            font-weight: bold;
            transition: background-color 0.3s; 
            margin-top: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        .section-title {
            color: #ff9800; 
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.4em;
            text-align: center;
            border-bottom: 2px solid #3a3a5e;
            padding-bottom: 8px;
        }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .input-manual-data {
            padding: 15px;
            border: 1px solid #ff9800;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .manual-data-title {
            color: #ff9800;
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .generated-avg {
            background-color: #4a4e69;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        .generated-avg strong {
            float: right;
            color: #8cffb6;
        }
        .correlation-input {
            grid-column: 1 / -1;
            margin-top: 10px;
            background-color: #4a4e69;
            padding: 15px;
            border-radius: 10px;
        }
        .resultado { 
            margin-top: 30px; 
            padding: 25px; 
            border: 4px dashed #ff9800;
            border-radius: 15px; 
            background-color: #3a3a5e;
        }
        .resultado p { 
            margin: 8px 0; 
            font-size: 1.3em; 
            display: flex;
            justify-content: space-between;
        }
        #process_data_button {
            background-color: #00bcd4;
            color: #1a1a2e;
        }
        #process_data_button:hover {
            background-color: #0097a7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>‚öΩ Calculadora Poisson Bivariante (BP)</h2>
        <small>Introduce las estad√≠sticas de tus tablas y las medias correctas de la liga.</small>
        
        <div class="section-title">1. Entrada de Estad√≠sticas de Tablas</div>

        <div class="input-manual-data" style="border-color: #00bcd4;">
            <div class="manual-data-title" style="color: #00bcd4;">Pegar Estad√≠sticas de Partidos como Local</div>
            <label for="home_table_input">Copia y pega la tabla de "Match total goals stats (at home)":</label>
            <textarea id="home_table_input" placeholder="Ej: Levante 4 4.25 100%..." oninput="clearResults()"></textarea>
        </div>

        <div class="input-manual-data" style="border-color: #ff9800;">
            <div class="manual-data-title" style="color: #ff9800;">Pegar Estad√≠sticas de Partidos como Visitante</div>
            <label for="away_table_input">Copia y pega la tabla de "Match total goals stats (away)":</label>
            <textarea id="away_table_input" placeholder="Ej: FC Barcelona 5 3.80 100%..." oninput="clearResults()"></textarea>
        </div>

        <button id="process_data_button" onclick="processAndSetupData()">1.1. üíæ Procesar Datos de Tablas y Cargar Equipos</button>
        
        <div class="section-title">2. Medias Promedio de la Liga</div>
        
        <div class="warning-text">
            ‚ö†Ô∏è **IMPORTANTE:** Estos valores son CRUCIALES. Deben ser la media de **Goles MARCADO POR LOCALES** y **Goles MARCADO POR VISITANTES** de TODA la liga.
        </div>
        <div class="input-group">
            <div class="input-manual-data">
                <label for="avg_league_home">Goles marcados por **LOCALES** en la liga ($\mu_L$):</label>
                <input type="number" id="avg_league_home" placeholder="Ej: 1.55" step="0.01" value="1.55" onchange="updateTeamAverages()">
            </div>
            <div class="input-manual-data">
                <label for="avg_league_away">Goles marcados por **VISITANTES** en la liga ($\mu_V$):</label>
                <input type="number" id="avg_league_away" placeholder="Ej: 1.15" step="0.01" value="1.15" onchange="updateTeamAverages()">
            </div>
        </div>

        <div class="section-title">3. Selecci√≥n de Equipos y sus Promedios (Estimados)</div>
        <div class="input-group">
            <div class="input-manual-data" style="border-color: #00bcd4;">
                <div class="manual-data-title" style="color: #00bcd4;">Equipo Local (L)</div>
                <label for="select_home_team">Selecciona Equipo Local:</label>
                <select id="select_home_team" onchange="updateTeamAverages()"></select>
                
                <div class="generated-avg">
                    Promedio Goles **A Favor** (Local): <strong id="display_home_scored">...</strong>
                    <input type="hidden" id="avg_home_scored" value="">
                </div>
                <div class="generated-avg">
                    Promedio Goles **En Contra** (Local): <strong id="display_home_conceded">...</strong>
                    <input type="hidden" id="avg_home_conceded" value="">
                </div>
            </div>
            <div class="input-manual-data" style="border-color: #ff9800;">
                <div class="manual-data-title" style="color: #ff9800;">Equipo Visitante (V)</div>
                <label for="select_away_team">Selecciona Equipo Visitante:</label>
                <select id="select_away_team" onchange="updateTeamAverages()"></select>

                <div class="generated-avg">
                    Promedio Goles **A Favor** (Visitante): <strong id="display_away_scored">...</strong>
                    <input type="hidden" id="avg_away_scored" value="">
                </div>
                <div class="generated-avg">
                    Promedio Goles **En Contra** (Visitante): <strong id="display_away_conceded">...</strong>
                    <input type="hidden" id="avg_away_conceded" value="">
                </div>
            </div>
        </div>
        
        <div class="section-title">4. Par√°metro de Correlaci√≥n ($\lambda_3$)</div>
        <div class="correlation-input">
            <label for="lambda_3">Correlaci√≥n ($\lambda_3$):</label>
            <input type="number" id="lambda_3" placeholder="Ej: 0.15" step="0.01" min="0" value="0.15">
            <small style="color:#f7a400;">Un valor $\lambda_3 > 0$ corrige la subestimaci√≥n de empates (ej. 1-1, 2-2).</small>
        </div>


        <button onclick="calculateManualBivariatePoisson()">5. Calcular Pron√≥stico Poisson Bivariante</button>

        <div class="resultado" id="resultados_poisson" style="display:none;">
            <div class="section-title" style="color:#ff9800; border-color:#ff9800;">üìä Resultados del Modelo Poisson Bivariante</div>

            <div class="calculation-summary">
                <h4>Detalle de Par√°metros Clave</h4>
                <p>Goles Esperados "Netos" Local ($\lambda_1$): <strong id="lambda_1_res">...</strong></p>
                <p>Goles Esperados "Netos" Visitante ($\lambda_2$): <strong id="lambda_2_res">...</strong></p>
                <p>Correlaci√≥n ($\lambda_3$): <strong id="lambda_3_res_summary">...</strong></p>
                <hr style="border-top: 1px dashed #4a4e69; margin: 10px 0;">
                <p>Fuerza Ataque Local: <strong id="att_L">...</strong> | Fuerza Defensa Visitante: <strong id="def_V">...</strong></p>
                <p>Fuerza Ataque Visitante: <strong id="att_V">...</strong> | Fuerza Defensa Local: <strong id="def_L">...</strong></p>
            </div>
            
            <div class="section-title" style="color:#ff9800; border-color:#ff9800; margin-top:20px;">Mercados de Goles</div>
            
            <p>Over 2.5 Goles: <strong id="over25Prob">...</strong></p>
            <p>Under 2.5 Goles: <strong id="under25Prob">...</strong></p>
            
            <div class="section-title" style="color:#ff9800; border-color:#ff9800; margin-top:20px;">Ambos Anotan (BTTS)</div>
            <p>BTTS Yes (S√≠): <strong id="bttsYesProb">...</strong></p>
            <p>BTTS No (No): <strong id="bttsNoProb">...</strong></p>

            <div class="section-title" style="color:#ff9800; border-color:#ff9800; margin-top:20px;">Resultado Final (1X2)</div>
            <p>Local (1): <strong id="prob_1">...</strong></p>
            <p>Empate (X): <strong id="prob_X">...</strong></p>
            <p>Visitante (2): <strong id="prob_2">...</strong></p>
            
        </div>

    </div>

    <script>
        const MAX_GOALS = 6; 
        
        // Variables globales para almacenar los datos procesados
        let HOME_STATS = {}; // {Equipo: Avg_Total_Goals_Home_Match}
        let AWAY_STATS = {}; // {Equipo: Avg_Total_Goals_Away_Match}

        // =======================================================
        // L√ìGICA DE PROCESAMIENTO DE TABLAS
        // =======================================================
        
        function processTableData(tableText) {
            const data = {};
            const lines = tableText.trim().split('\n');

            // Ignorar la primera l√≠nea si es el encabezado (ej: "Home matches of... GP Avg...")
            const dataLines = lines.length > 0 && lines[0].includes('Avg') ? lines.slice(1) : lines;

            dataLines.forEach(line => {
                const teamNameRegex = /([\w\s]+?)\s+\d+/;
                const nameMatch = line.trim().match(teamNameRegex);

                if (nameMatch) {
                    const teamName = nameMatch[1].trim();
                    
                    // Sustituir el nombre del equipo y el GP (ej: "Levante 4") por un espacio para aislar los n√∫meros
                    let cleanLine = line.trim().substring(nameMatch[0].length).trim();
                    const parts = cleanLine.split(/\s+/);
                    
                    // El promedio (Avg) es el primer valor num√©rico que queda (ya quitamos el GP)
                    if (parts.length >= 1) {
                        const avgValue = parseFloat(parts[0]);
                        if (!isNaN(avgValue)) {
                            data[teamName] = avgValue;
                        }
                    }
                }
            });
            return data;
        }

        function processAndSetupData() {
            const homeText = document.getElementById('home_table_input').value;
            const awayText = document.getElementById('away_table_input').value;

            HOME_STATS = processTableData(homeText);
            AWAY_STATS = processTableData(awayText);

            if (Object.keys(HOME_STATS).length === 0 || Object.keys(AWAY_STATS).length === 0) {
                alert("Error al procesar los datos. Aseg√∫rate de que las tablas est√©n copiadas correctamente y que contengan los campos 'Equipo' y 'Avg'.");
                clearResults();
                return;
            }

            populateTeamSelectors();
            
            // Intentar establecer una selecci√≥n por defecto y calcular
            const firstHomeTeam = Object.keys(HOME_STATS)[0];
            const firstAwayTeam = Object.keys(AWAY_STATS)[0];
            
            document.getElementById('select_home_team').value = firstHomeTeam || '';
            document.getElementById('select_away_team').value = firstAwayTeam || '';
            
            // Forzamos la actualizaci√≥n de promedios para mostrar los resultados iniciales
            updateTeamAverages();
            
            alert(`‚úÖ Datos cargados. ${Object.keys(HOME_STATS).length} equipos locales y ${Object.keys(AWAY_STATS).length} equipos visitantes disponibles para la selecci√≥n.`);
        }

        function populateTeamSelectors() {
            const homeSelect = document.getElementById('select_home_team');
            const awaySelect = document.getElementById('select_away_team');
            
            // Limpiar selectores
            homeSelect.innerHTML = '<option value="">--- Seleccione Local ---</option>';
            awaySelect.innerHTML = '<option value="">--- Seleccione Visitante ---</option>';

            // Obtener todos los nombres de equipos √∫nicos
            const allTeams = new Set([...Object.keys(HOME_STATS), ...Object.keys(AWAY_STATS)]);
            const sortedTeams = Array.from(allTeams).sort();

            sortedTeams.forEach(team => {
                // Solo a√±adir si el equipo tiene estad√≠sticas relevantes para la posici√≥n
                if (HOME_STATS.hasOwnProperty(team)) {
                    const homeOption = document.createElement('option');
                    homeOption.value = team;
                    homeOption.textContent = team;
                    homeSelect.appendChild(homeOption);
                }

                if (AWAY_STATS.hasOwnProperty(team)) {
                    const awayOption = document.createElement('option');
                    awayOption.value = team;
                    awayOption.textContent = team;
                    awaySelect.appendChild(awayOption);
                }
            });
        }
        
        // =======================================================
        // L√ìGICA DE C√ÅLCULO DE FUERZAS Y LAMBDA
        // =======================================================

        function updateTeamAverages() {
            const homeTeam = document.getElementById('select_home_team').value;
            const awayTeam = document.getElementById('select_away_team').value;

            if (!homeTeam || !awayTeam) {
                clearAverages();
                clearResults();
                return;
            }

            // Medias de Goles MARCADO por Locales y Visitantes en la Liga (CRUCIALES)
            const avgLeagueL = parseFloat(document.getElementById('avg_league_home').value);
            const avgLeagueV = parseFloat(document.getElementById('avg_league_away').value);

            if (isNaN(avgLeagueL) || isNaN(avgLeagueV) || avgLeagueL <= 0 || avgLeagueV <= 0) {
                // No mostramos un alert, solo limpiamos y salimos, esperando que el usuario lo corrija.
                clearAverages();
                clearResults();
                return;
            }

            // Obtener la media total de goles del partido para el equipo seleccionado
            const homeMatchAvgGoals = HOME_STATS[homeTeam]; 
            const awayMatchAvgGoals = AWAY_STATS[awayTeam]; 
            
            if (homeMatchAvgGoals === undefined || awayMatchAvgGoals === undefined) {
                 clearAverages();
                 clearResults();
                 return;
            }

            // ************ ESTIMACI√ìN CLAVE ************
            // La suma de los Goles Marcados por ambos equipos en el partido debe ser igual a la Media Total del Partido.
            // Avg Goles Partido L = (L Marcados) + (V Marcados Oponente)
            // L Marcados (A Favor) = Avg Goles Partido L - V Marcados Oponente
            // Usamos la media de la liga como la estimaci√≥n de los goles marcados por el Oponente.

            // 1. Equipo Local (L)
            // L Concedidos (Defensa L) = Media de goles que MARCA un Visitante promedio
            const avg_home_conceded = avgLeagueV; 
            // L Marcados (Ataque L) = Media Total del partido L - Goles que marca el visitante promedio (Goles Concedidos L)
            const avg_home_scored_est = homeMatchAvgGoals - avg_home_conceded;

            // 2. Equipo Visitante (V)
            // V Concedidos (Defensa V) = Media de goles que MARCA un Local promedio
            const avg_away_conceded = avgLeagueL;
            // V Marcados (Ataque V) = Media Total del partido V - Goles que marca el local promedio (Goles Concedidos V)
            const avg_away_scored_est = awayMatchAvgGoals - avg_away_conceded;
            
            // Validar que los promedios de ataque (goles marcados) sean positivos
            if (avg_home_scored_est <= 0 || avg_away_scored_est <= 0) {
                 alert("Advertencia: Los Goles A Favor calculados para uno o ambos equipos son no positivos. Aseg√∫rate de que las medias de liga ($\mu_L$, $\mu_V$) en el Paso 2 sean correctas. El c√°lculo fallar√°.");
                 clearResults();
                 clearAverages();
                 return;
            }
            
            // Actualizar inputs (ocultos) y display
            // Local
            document.getElementById('avg_home_scored').value = avg_home_scored_est.toFixed(3);
            document.getElementById('display_home_scored').textContent = avg_home_scored_est.toFixed(3);
            document.getElementById('avg_home_conceded').value = avg_home_conceded.toFixed(3);
            document.getElementById('display_home_conceded').textContent = avg_home_conceded.toFixed(3);

            // Visitante
            document.getElementById('avg_away_scored').value = avg_away_scored_est.toFixed(3);
            document.getElementById('display_away_scored').textContent = avg_away_scored_est.toFixed(3);
            document.getElementById('avg_away_conceded').value = avg_away_conceded.toFixed(3);
            document.getElementById('display_away_conceded').textContent = avg_away_conceded.toFixed(3);
            
            // Ejecutar el c√°lculo principal autom√°ticamente
            calculateManualBivariatePoisson();
        }

        function clearAverages() {
            document.getElementById('avg_home_scored').value = '';
            document.getElementById('display_home_scored').textContent = '...';
            document.getElementById('avg_home_conceded').value = '';
            document.getElementById('display_home_conceded').textContent = '...';
            document.getElementById('avg_away_scored').value = '';
            document.getElementById('display_away_scored').textContent = '...';
            document.getElementById('avg_away_conceded').value = '';
            document.getElementById('display_away_conceded').textContent = '...';
        }

        function clearResults() {
            document.getElementById('resultados_poisson').style.display = 'none';
        }


        // =======================================================
        // FUNCIONES DE C√ÅLCULO POISSON BIVARIANTE (Mismo que antes)
        // =======================================================

        function calculateManualBivariatePoisson() {
            const resultsDiv = document.getElementById('resultados_poisson');

            // 1. Obtener Entradas
            const avgLeagueL = parseFloat(document.getElementById('avg_league_home').value);
            const avgLeagueV = parseFloat(document.getElementById('avg_league_away').value);
            const lambda3 = parseFloat(document.getElementById('lambda_3').value);
            
            const avgHomeScored = parseFloat(document.getElementById('avg_home_scored').value);
            const avgHomeConceded = parseFloat(document.getElementById('avg_home_conceded').value);
            
            const avgAwayScored = parseFloat(document.getElementById('avg_away_scored').value);
            const avgAwayConceded = parseFloat(document.getElementById('avg_away_conceded').value);

            if (isNaN(avgHomeScored) || avgHomeScored <= 0 || isNaN(avgAwayScored) || avgAwayScored <= 0 || 
                isNaN(avgLeagueL) || avgLeagueL <= 0 || isNaN(avgLeagueV) || avgLeagueV <= 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            try {
                // 2. Calcular Fuerzas
                const attackL = avgHomeScored / avgLeagueL;
                const attackV = avgAwayScored / avgLeagueV;
                const defenseL = avgHomeConceded / avgLeagueV; 
                const defenseV = avgAwayConceded / avgLeagueL; 

                // 3. Calcular Goles Esperados del Poisson EST√ÅNDAR
                const lambdaL_SP = attackL * defenseV * avgLeagueL;
                const lambdaV_SP = attackV * defenseL * avgLeagueV;
                
                // 4. Calcular los par√°metros NETOS del Bivariante (Œª1, Œª2)
                const lambda1 = lambdaL_SP - lambda3;
                const lambda2 = lambdaV_SP - lambda3;
                
                if (lambda1 < 0 || lambda2 < 0) {
                     throw new Error(`Error Bivariante: La correlaci√≥n ($\lambda_3$: ${lambda3.toFixed(3)}) es demasiado alta. Debe ser menor o igual a ambos Goles Esperados Est√°ndar ($\lambda_L$: ${lambdaL_SP.toFixed(3)} y $\lambda_V$: ${lambdaV_SP.toFixed(3)}).`);
                }

                const params = {
                    lambda1, lambda2, lambda3, 
                    attackL, defenseV, 
                    attackV, defenseL,
                    avgLeagueL, avgLeagueV,
                };

                // 5. Calcular Probabilidades Poisson Bivariante
                const probabilities = calculateBivariatePoissonProbabilities(lambda1, lambda2, lambda3);
                
                // 6. Mostrar Resultados
                displayResults(probabilities, params);
                resultsDiv.style.display = 'block';

            } catch (error) {
                alert("Error durante el c√°lculo: " + error.message);
                resultsDiv.style.display = 'none';
            }
        }
        
        // --- POISSON BIVARIANTE (BP) (Funci√≥n principal de un marcador) ---
        function factorial(n) {
            if (n === 0 || n === 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }
        
        function bivariate_poisson_prob(x, y, lambda1, lambda2, lambda3) {
            x = Math.round(x);
            y = Math.round(y);
            
            const c = Math.exp(-(lambda1 + lambda2 + lambda3));
            const min_xy = Math.min(x, y);
            
            let sumatoria = 0;
            for (let i = 0; i <= min_xy; i++) {
                const term1 = Math.pow(lambda1, x - i) / factorial(x - i);
                const term2 = Math.pow(lambda2, y - i) / factorial(y - i);
                const term3 = Math.pow(lambda3, i) / factorial(i);
                sumatoria += term1 * term2 * term3;
            }
            
            return c * sumatoria;
        }

        function calculateBivariatePoissonProbabilities(lambda1, lambda2, lambda3) {
            let p_win_L = 0;
            let p_draw = 0;
            let p_win_V = 0;
            let p_total_0 = 0;
            let p_total_1 = 0;
            let p_total_2 = 0;
            let p_btts_ft = 0;
            let p_suma_total_ft = 0;
            let P_LV_Function = (L, V) => bivariate_poisson_prob(L, V, lambda1, lambda2, lambda3);

            for (let L = 0; L <= MAX_GOALS; L++) {
                for (let V = 0; V <= MAX_GOALS; V++) {
                    const P_LV = P_LV_Function(L, V);
                    p_suma_total_ft += P_LV; 
                    
                    if (L > V) p_win_L += P_LV;
                    else if (L === V) p_draw += P_LV;
                    else p_win_V += P_LV;
                    
                    const total = L + V;
                    if (total === 0) p_total_0 += P_LV;
                    if (total === 1) p_total_1 += P_LV;
                    if (total === 2) p_total_2 += P_LV;
                    
                    if (L > 0 && V > 0) p_btts_ft += P_LV; 
                }
            }
            
            if (p_suma_total_ft === 0) throw new Error("La suma total de probabilidades es cero.");

            const factor = 1.0 / p_suma_total_ft;

            p_win_L *= factor;
            p_draw *= factor;
            p_win_V *= factor;
            p_btts_ft *= factor;
            const p_under_2_5_ft = (p_total_0 + p_total_1 + p_total_2) * factor;
            
            return {
                p_win_L: p_win_L, p_draw: p_draw, p_win_V: p_win_V,
                p_under_2_5: p_under_2_5_ft, 
                p_over_2_5: 1 - p_under_2_5_ft,
                p_btts_yes: p_btts_ft, 
                p_btts_no: 1 - p_btts_ft,
            };
        }

        const calculateOdds = (probability) => (probability > 0 ? (1 / probability).toFixed(2) : '‚àû');
        
        const formatOutput = (prob) => {
            const percentage = (prob * 100).toFixed(2);
            const odds = calculateOdds(prob);
            return `${percentage}% (Cuota: ${odds})`; 
        };

        function displayResults(probabilities, params) {
            // Mostrar Detalle de C√°lculos (Fuerzas y Lambdas Netos)
            document.getElementById('lambda_1_res').textContent = params.lambda1.toFixed(3);
            document.getElementById('lambda_2_res').textContent = params.lambda2.toFixed(3);
            document.getElementById('lambda_3_res_summary').textContent = params.lambda3.toFixed(3);
            
            document.getElementById('att_L').textContent = params.attackL.toFixed(3);
            document.getElementById('def_V').textContent = params.defenseV.toFixed(3);
            document.getElementById('att_V').textContent = params.attackV.toFixed(3);
            document.getElementById('def_L').textContent = params.defenseL.toFixed(3);
            
            // Mostrar Resultados de Mercados
            document.getElementById('over25Prob').textContent = formatOutput(probabilities.p_over_2_5);
            document.getElementById('under25Prob').textContent = formatOutput(probabilities.p_under_2_5);
            document.getElementById('bttsYesProb').textContent = formatOutput(probabilities.p_btts_yes);
            document.getElementById('bttsNoProb').textContent = formatOutput(probabilities.p_btts_no);

            // Mostrar 1X2
            document.getElementById('prob_1').textContent = formatOutput(probabilities.p_win_L);
            document.getElementById('prob_X').textContent = formatOutput(probabilities.p_draw);
            document.getElementById('prob_2').textContent = formatOutput(probabilities.p_win_V);
        }
    </script>
</body>
</html>
