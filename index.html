<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bot Finder - Deep League Optimizer</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #238636; --text: #c9d1d9; --gold: #d29922; --win: #2ea043; --loss: #f85149; --info: #58a6ff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        textarea { width: 100%; height: 200px; background: #010409; color: #7ee787; border: 1px solid #30363d; padding: 15px; border-radius: 6px; box-sizing: border-box; font-family: monospace; }
        .panel { background: var(--card); border: 1px solid #30363d; border-radius: 6px; padding: 20px; margin-bottom: 20px; }
        button { background: var(--info); color: white; border: none; padding: 15px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1em; }
        button:hover { filter: brightness(1.2); }
        .bot-config { background: #010409; border: 2px solid var(--win); padding: 15px; border-radius: 6px; color: #7ee787; font-family: monospace; }
        .match-entry { border-bottom: 1px solid #30363d; padding: 8px 0; display: flex; justify-content: space-between; font-size: 0.85em; }
        .status-win { color: var(--win); font-weight: bold; }
        .status-loss { color: var(--loss); font-weight: bold; }
        .loading { display: none; text-align: center; color: var(--gold); font-weight: bold; margin: 10px 0; }
        .summary-card { background: #21262d; padding: 15px; border-radius: 6px; margin-top: 10px; border-left: 4px solid var(--info); }
        .log-search { font-size: 0.8em; color: #8b949e; height: 120px; overflow-y: auto; background: #010409; padding: 10px; border-radius: 5px; margin-top: 10px; }
        .league-tag { font-size: 0.75em; background: #30363d; padding: 2px 5px; border-radius: 3px; color: #8b949e; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" style="text-align:center;">
        <h2>üß† IA Deep Search: Patrones + Ligas Rentables</h2>
        <p>Buscando rentabilidad real a cuota 1.60 mediante filtrado masivo</p>
    </div>

    <div class="grid">
        <div class="left-col">
            <div class="panel">
                <h3>1. Inserci√≥n de Datos Masivos</h3>
                <textarea id="dataInput" placeholder="Pega aqu√≠ los datos hist√≥ricos (incluyendo columna de Liga/League)..."></textarea>
                <button onclick="startDeepSearch()">Ejecutar B√∫squeda de Bot Rentable</button>
                <div id="loadingText" class="loading">üîç Escaneando patrones y ligas...</div>
                <div id="searchLog" class="log-search">Esperando datos...</div>
            </div>

            <div class="panel">
                <h3>2. Auditor√≠a de Partidos</h3>
                <div id="matchList"></div>
            </div>
        </div>

        <div class="right-col">
            <div id="resultPanel" style="display:none;">
                <div class="panel" style="border-color: var(--win);">
                    <h3>‚úÖ Bot Rentable Encontrado</h3>
                    <div id="botConfig" class="bot-config"></div>
                </div>

                <div class="panel">
                    <h3>üìä Rendimiento Global</h3>
                    <div id="roiStats"></div>
                </div>

                <div class="panel" id="leagueBreakdown" style="border-top: 3px solid var(--gold);">
                    <h3>üèÜ Top Ligas para este Bot</h3>
                    <div id="leagueList" style="font-size: 0.9em;"></div>
                </div>
            </div>
            
            <div id="noResultPanel" class="panel" style="display:none; border-color: var(--loss);">
                <h3>‚ö†Ô∏è Sin Rentabilidad Encontrada</h3>
                <p>Ninguna combinaci√≥n de filtros super√≥ el 62.5% de Strike Rate necesario para cuota 1.60. Prueba cargando m√°s datos.</p>
            </div>
        </div>
    </div>
</div>

<script>
function startDeepSearch() {
    const input = document.getElementById('dataInput').value;
    const lines = input.split('\n').filter(l => l.trim() !== "" && !l.toLowerCase().includes('match'));
    const log = document.getElementById('searchLog');
    const loading = document.getElementById('loadingText');
    
    if (lines.length < 5) {
        alert("Pega m√°s datos. Se recomienda un m√≠nimo de 15-20 partidos para detectar patrones reales.");
        return;
    }

    loading.style.display = "block";
    log.innerHTML = "Iniciando an√°lisis geogr√°fico y estad√≠stico...<br>";
    
    // Pruebas de filtros
    const apTests = [1.0, 1.25, 1.45, 1.65, 1.85];
    const shotTests = [0, 1, 2];
    
    let bestBot = null;
    let maxROI = -100;

    setTimeout(() => {
        apTests.forEach(apMin => {
            shotTests.forEach(shots => {
                let total = 0;
                let wins = 0;
                let selectedMatches = [];
                let leagues = {};

                lines.forEach(line => {
                    const cols = line.split('\t');
                    if (cols.length < 42) return;

                    const league = cols[1] || "Otros"; // Asumiendo columna 1 para Liga
                    const minute = parseInt(cols[7]) || 1;
                    const ap = (parseInt(cols[11]) || 0) + (parseInt(cols[12]) || 0);
                    const shOn = (parseInt(cols[15]) || 0) + (parseInt(cols[16]) || 0);
                    const resultHT = cols[41].trim();
                    
                    const apM = ap / minute;
                    const isWin = (resultHT !== "0-0" && resultHT !== "");

                    if (apM >= apMin && shOn >= shots) {
                        total++;
                        if (isWin) wins++;
                        
                        // Registro de ligas
                        if (!leagues[league]) leagues[league] = {t: 0, w: 0};
                        leagues[league].t++;
                        if (isWin) leagues[league].w++;

                        selectedMatches.push({name: cols[6], res: resultHT, win: isWin, apm: apM, league: league});
                    }
                });

                if (total >= 4) {
                    const roi = ((wins * 1.60 - total) / total * 100);
                    log.innerHTML += `Test: AP>${apMin} + SH>${shots} | ROI: ${roi.toFixed(1)}%<br>`;
                    log.scrollTop = log.scrollHeight;

                    if (roi > maxROI) {
                        maxROI = roi;
                        bestBot = { apMin, shots, roi, wins, total, matches: selectedMatches, leagues };
                    }
                }
            });
        });

        loading.style.display = "none";
        displayBestBot(bestBot);
    }, 1200);
}

function displayBestBot(bot) {
    const resPanel = document.getElementById('resultPanel');
    const noRes = document.getElementById('noResultPanel');
    const matchList = document.getElementById('matchList');
    const leagueList = document.getElementById('leagueList');

    if (bot && bot.roi > 0) {
        resPanel.style.display = "block";
        noRes.style.display = "none";
        
        document.getElementById('botConfig').innerHTML = `
            FILTROS √ìPTIMOS:<br>
            --------------------<br>
            Ataques Pel/Min: > ${bot.apMin.toFixed(2)}<br>
            Tiros a Puerta: >= ${bot.shots}<br>
            Mercado: Over 0.5 HT @1.60
        `;

        document.getElementById('roiStats').innerHTML = `
            <div class="summary-card">
                <span style="font-size: 1.5em; font-weight: bold; color: var(--win);">ROI: ${bot.roi.toFixed(1)}%</span><br>
                <span>Acierto: ${((bot.wins/bot.total)*100).toFixed(1)}% (${bot.wins}/${bot.total})</span>
            </div>
        `;

        // Mostrar desglose de ligas
        leagueList.innerHTML = "";
        Object.keys(bot.leagues).forEach(l => {
            const lData = bot.leagues[l];
            const lRoi = ((lData.w * 1.60 - lData.t) / lData.t * 100).toFixed(0);
            leagueList.innerHTML += `
                <div style="margin-bottom:5px;">
                    <span class="league-tag">${l}</span> 
                    <span style="color:${lRoi >= 0 ? 'var(--win)' : 'var(--loss)'}">${lRoi}% ROI</span>
                </div>`;
        });

        matchList.innerHTML = bot.matches.map(m => `
            <div class="match-entry">
                <span><small>${m.league}</small><br><strong>${m.name}</strong></span>
                <span class="${m.win ? 'status-win' : 'status-loss'}">${m.res}</span>
            </div>
        `).join('');

    } else {
        resPanel.style.display = "none";
        noRes.style.display = "block";
    }
}
</script>
</body>
</html>
